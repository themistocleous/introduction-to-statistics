"use strict";var In=Object.create,st=Object.defineProperty,Un=Object.getOwnPropertyDescriptor,Cn=Object.getOwnPropertyNames,jn=Object.getPrototypeOf,Nn=Object.prototype.hasOwnProperty,P=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Bn=(e,t)=>{for(var r in t)st(e,r,{get:t[r],enumerable:!0})},Ur=(e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of Cn(t))!Nn.call(e,s)&&s!==r&&st(e,s,{get:()=>t[s],enumerable:!(i=Un(t,s))||i.enumerable});return e},Z=(e,t,r)=>(r=null!=e?In(jn(e)):{},Ur(!t&&e&&e.__esModule?r:st(r,"default",{value:e,enumerable:!0}),e)),Ln=e=>Ur(st({},"__esModule",{value:!0}),e),Zt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},i=(e,t,r)=>(Zt(e,t,"read from private field"),r?r.call(e):t.get(e)),u=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},h=(e,t,r,i)=>(Zt(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),v=(e,t,r)=>(Zt(e,t,"access private method"),r),_e=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getUint64=e.getInt64=e.setInt64=e.setUint64=e.UINT32_MAX=void 0,e.UINT32_MAX=4294967295,e.setUint64=function(e,t,r){let i=r/4294967296,s=r;e.setUint32(t,i),e.setUint32(t+4,s)},e.setInt64=function(e,t,r){let i=Math.floor(r/4294967296),s=r;e.setUint32(t,i),e.setUint32(t+4,s)},e.getInt64=function(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)},e.getUint64=function(e,t){return 4294967296*e.getUint32(t)+e.getUint32(t+4)}}),ct=P(e=>{var t,r,i;Object.defineProperty(e,"__esModule",{value:!0}),e.utf8DecodeTD=e.TEXT_DECODER_THRESHOLD=e.utf8DecodeJs=e.utf8EncodeTE=e.TEXT_ENCODER_THRESHOLD=e.utf8EncodeJs=e.utf8Count=void 0;var s=_e(),n=(typeof process>"u"||"never"!==(null===(t=null==process?void 0:process.env)||void 0===t?void 0:t.TEXT_ENCODING))&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";e.utf8Count=function(e){let t=e.length,r=0,i=0;for(;i<t;){let s=e.charCodeAt(i++);if(4294967168&s)if(4294965248&s){if(s>=55296&&s<=56319&&i<t){let t=e.charCodeAt(i);56320===(64512&t)&&(++i,s=((1023&s)<<10)+(1023&t)+65536)}r+=4294901760&s?4:3}else r+=2;else r++}return r},e.utf8EncodeJs=function(e,t,r){let i=e.length,s=r,n=0;for(;n<i;){let r=e.charCodeAt(n++);if(4294967168&r){if(4294965248&r){if(r>=55296&&r<=56319&&n<i){let t=e.charCodeAt(n);56320===(64512&t)&&(++n,r=((1023&r)<<10)+(1023&t)+65536)}4294901760&r?(t[s++]=r>>18&7|240,t[s++]=r>>12&63|128,t[s++]=r>>6&63|128):(t[s++]=r>>12&15|224,t[s++]=r>>6&63|128)}else t[s++]=r>>6&31|192;t[s++]=63&r|128}else t[s++]=r}};var a=n?new TextEncoder:void 0;e.TEXT_ENCODER_THRESHOLD=n?typeof process<"u"&&"force"!==(null===(r=null==process?void 0:process.env)||void 0===r?void 0:r.TEXT_ENCODING)?200:0:s.UINT32_MAX,e.utf8EncodeTE=null!=a&&a.encodeInto?function(e,t,r){a.encodeInto(e,t.subarray(r))}:function(e,t,r){t.set(a.encode(e),r)};e.utf8DecodeJs=function(e,t,r){let i=t,s=i+r,n=[],a="";for(;i<s;){let t=e[i++];if(128&t)if(192===(224&t)){let r=63&e[i++];n.push((31&t)<<6|r)}else if(224===(240&t)){let r=63&e[i++],s=63&e[i++];n.push((31&t)<<12|r<<6|s)}else if(240===(248&t)){let r=(7&t)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++];r>65535&&(r-=65536,n.push(r>>>10&1023|55296),r=56320|1023&r),n.push(r)}else n.push(t);else n.push(t);n.length>=4096&&(a+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(a+=String.fromCharCode(...n)),a};var o=n?new TextDecoder:null;e.TEXT_DECODER_THRESHOLD=n?typeof process<"u"&&"force"!==(null===(i=null==process?void 0:process.env)||void 0===i?void 0:i.TEXT_DECODER)?200:0:s.UINT32_MAX,e.utf8DecodeTD=function(e,t,r){let i=e.subarray(t,t+r);return o.decode(i)}}),sr=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtData=void 0;e.ExtData=class{constructor(e,t){this.type=e,this.data=t}}}),dt=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DecodeError=void 0;var t=class extends Error{constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};e.DecodeError=t}),or=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.timestampExtension=e.decodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimestampExtension=e.encodeDateToTimeSpec=e.encodeTimeSpecToTimestamp=e.EXT_TIMESTAMP=void 0;var t=dt(),r=_e();e.EXT_TIMESTAMP=-1;function i({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=17179869183){if(0===t&&e<=4294967295){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}{let r=e/4294967296,i=4294967295&e,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,t<<2|3&r),n.setUint32(4,i),s}}{let i=new Uint8Array(12),s=new DataView(i.buffer);return s.setUint32(0,t),(0,r.setInt64)(s,4,e),i}}function s(e){let t=e.getTime(),r=Math.floor(t/1e3),i=1e6*(t-1e3*r),s=Math.floor(i/1e9);return{sec:r+s,nsec:i-1e9*s}}function n(e){if(e instanceof Date){return i(s(e))}return null}function a(e){let i=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:i.getUint32(0),nsec:0};case 8:{let e=i.getUint32(0);return{sec:4294967296*(3&e)+i.getUint32(4),nsec:e>>>2}}case 12:return{sec:(0,r.getInt64)(i,4),nsec:i.getUint32(0)};default:throw new t.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function o(e){let t=a(e);return new Date(1e3*t.sec+t.nsec/1e6)}e.encodeTimeSpecToTimestamp=i,e.encodeDateToTimeSpec=s,e.encodeTimestampExtension=n,e.decodeTimestampToTimeSpec=a,e.decodeTimestampExtension=o,e.timestampExtension={type:e.EXT_TIMESTAMP,encode:n,decode:o}}),ft=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionCodec=void 0;var t=sr(),r=or(),i=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(r.timestampExtension)}register({type:e,encode:t,decode:r}){if(e>=0)this.encoders[e]=t,this.decoders[e]=r;else{let i=1+e;this.builtInEncoders[i]=t,this.builtInDecoders[i]=r}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){let s=this.builtInEncoders[i];if(null!=s){let n=s(e,r);if(null!=n){let e=-1-i;return new t.ExtData(e,n)}}}for(let i=0;i<this.encoders.length;i++){let s=this.encoders[i];if(null!=s){let n=s(e,r);if(null!=n){let e=i;return new t.ExtData(e,n)}}}return e instanceof t.ExtData?e:null}decode(e,r,i){let s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,i):new t.ExtData(r,e)}};e.ExtensionCodec=i,i.defaultCodec=new i}),ir=P(e=>{function t(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.createDataView=e.ensureUint8Array=void 0,e.ensureUint8Array=t,e.createDataView=function(e){if(e instanceof ArrayBuffer)return new DataView(e);let r=t(e);return new DataView(r.buffer,r.byteOffset,r.byteLength)}}),lr=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Encoder=e.DEFAULT_INITIAL_BUFFER_SIZE=e.DEFAULT_MAX_DEPTH=void 0;var t=ct(),r=ft(),i=_e(),s=ir();e.DEFAULT_MAX_DEPTH=100,e.DEFAULT_INITIAL_BUFFER_SIZE=2048;e.Encoder=class{constructor(t=r.ExtensionCodec.defaultCodec,i=void 0,s=e.DEFAULT_MAX_DEPTH,n=e.DEFAULT_INITIAL_BUFFER_SIZE,a=!1,o=!1,l=!1,h=!1){this.extensionCodec=t,this.context=i,this.maxDepth=s,this.initialBufferSize=n,this.sortKeys=a,this.forceFloat32=o,this.ignoreUndefined=l,this.forceIntegerToFloat=h,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}encode(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){let t=new ArrayBuffer(e),r=new Uint8Array(t),i=new DataView(t);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error(`Too long string: ${e} bytes in UTF-8`);this.writeU8(219),this.writeU32(e)}}encodeString(e){if(e.length>t.TEXT_ENCODER_THRESHOLD){let r=(0,t.utf8Count)(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),(0,t.utf8EncodeTE)(e,this.bytes,this.pos),this.pos+=r}else{let r=(0,t.utf8Count)(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),(0,t.utf8EncodeJs)(e,this.bytes,this.pos),this.pos+=r}}encodeObject(e,t){let r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`);this.encodeMap(e,t)}}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large binary: ${t}`);this.writeU8(198),this.writeU32(t)}let r=(0,s.ensureUint8Array)(e);this.writeU8a(r)}encodeArray(e,t){let r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error(`Too large array: ${r}`);this.writeU8(221),this.writeU32(r)}for(let i of e)this.doEncode(i,t+1)}countWithoutUndefined(e,t){let r=0;for(let i of t)void 0!==e[i]&&r++;return r}encodeMap(e,t){let r=Object.keys(e);this.sortKeys&&r.sort();let i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else{if(!(i<4294967296))throw new Error(`Too large map object: ${i}`);this.writeU8(223),this.writeU32(i)}for(let s of r){let r=e[s];this.ignoreUndefined&&void 0===r||(this.encodeString(s),this.doEncode(r,t+1))}}encodeExtension(e){let t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large extension object: ${t}`);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),(0,i.setUint64)(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),(0,i.setInt64)(this.view,this.pos,e),this.pos+=8}}}),Xr=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var t=lr(),r={};e.encode=function(e,i=r){return new t.Encoder(i.extensionCodec,i.context,i.maxDepth,i.initialBufferSize,i.sortKeys,i.forceFloat32,i.ignoreUndefined,i.forceIntegerToFloat).encodeSharedRef(e)}}),Gr=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.prettyByte=void 0,e.prettyByte=function(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}}),$r=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CachedKeyDecoder=void 0;var t=ct();e.CachedKeyDecoder=class{constructor(e=16,t=16){this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,r){let i=this.caches[r-1];e:for(let s of i){let i=s.bytes;for(let s=0;s<r;s++)if(i[s]!==e[t+s])continue e;return s.str}return null}store(e,t){let r=this.caches[e.length-1],i={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,r,i){let s=this.find(e,r,i);if(null!=s)return this.hit++,s;this.miss++;let n=(0,t.utf8DecodeJs)(e,r,i),a=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(a,n),n}}}),bt=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.DataViewIndexOutOfBoundsError=void 0;var t=Gr(),r=ft(),i=_e(),s=ct(),n=ir(),a=$r(),o=dt(),l=e=>{let t=typeof e;return"string"===t||"number"===t},h=new DataView(new ArrayBuffer(0)),u=new Uint8Array(h.buffer);e.DataViewIndexOutOfBoundsError=(()=>{try{h.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")})();var c=new e.DataViewIndexOutOfBoundsError("Insufficient data"),d=new a.CachedKeyDecoder;e.Decoder=class{constructor(e=r.ExtensionCodec.defaultCodec,t=void 0,s=i.UINT32_MAX,n=i.UINT32_MAX,a=i.UINT32_MAX,o=i.UINT32_MAX,l=i.UINT32_MAX,c=d){this.extensionCodec=e,this.context=t,this.maxStrLength=s,this.maxBinLength=n,this.maxArrayLength=a,this.maxMapLength=o,this.maxExtLength=l,this.keyDecoder=c,this.totalPos=0,this.pos=0,this.view=h,this.bytes=u,this.headByte=-1,this.stack=[]}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.length=0}setBuffer(e){this.bytes=(0,n.ensureUint8Array)(e),this.view=(0,n.createDataView)(this.bytes),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){let t=this.bytes.subarray(this.pos),r=(0,n.ensureUint8Array)(e),i=new Uint8Array(t.length+r.length);i.set(t),i.set(r,t.length),this.setBuffer(i)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:r}=this;return new RangeError(`Extra ${t.byteLength-r} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}*decodeMulti(e){for(this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}async decodeAsync(r){let i,s=!1;for await(let t of r){if(s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(t);try{i=this.doDecodeSync(),s=!0}catch(l){if(!(l instanceof e.DataViewIndexOutOfBoundsError))throw l}this.totalPos+=this.pos}if(s){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}let{headByte:n,pos:a,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${(0,t.prettyByte)(n)} at ${o} (${a} in the current buffer)`)}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(t,r){let i=r,s=-1;for await(let a of t){if(r&&0===s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),0!==--s;);}catch(n){if(!(n instanceof e.DataViewIndexOutOfBoundsError))throw n}this.totalPos+=this.pos}}doDecodeSync(){e:for(;;){let e,r=this.readHeadByte();if(r>=224)e=r-256;else if(r<192)if(r<128)e=r;else if(r<144){let t=r-128;if(0!==t){this.pushMapState(t),this.complete();continue e}e={}}else if(r<160){let t=r-144;if(0!==t){this.pushArrayState(t),this.complete();continue e}e=[]}else{let t=r-160;e=this.decodeUtf8String(t,0)}else if(192===r)e=null;else if(194===r)e=!1;else if(195===r)e=!0;else if(202===r)e=this.readF32();else if(203===r)e=this.readF64();else if(204===r)e=this.readU8();else if(205===r)e=this.readU16();else if(206===r)e=this.readU32();else if(207===r)e=this.readU64();else if(208===r)e=this.readI8();else if(209===r)e=this.readI16();else if(210===r)e=this.readI32();else if(211===r)e=this.readI64();else if(217===r){let t=this.lookU8();e=this.decodeUtf8String(t,1)}else if(218===r){let t=this.lookU16();e=this.decodeUtf8String(t,2)}else if(219===r){let t=this.lookU32();e=this.decodeUtf8String(t,4)}else if(220===r){let t=this.readU16();if(0!==t){this.pushArrayState(t),this.complete();continue e}e=[]}else if(221===r){let t=this.readU32();if(0!==t){this.pushArrayState(t),this.complete();continue e}e=[]}else if(222===r){let t=this.readU16();if(0!==t){this.pushMapState(t),this.complete();continue e}e={}}else if(223===r){let t=this.readU32();if(0!==t){this.pushMapState(t),this.complete();continue e}e={}}else if(196===r){let t=this.lookU8();e=this.decodeBinary(t,1)}else if(197===r){let t=this.lookU16();e=this.decodeBinary(t,2)}else if(198===r){let t=this.lookU32();e=this.decodeBinary(t,4)}else if(212===r)e=this.decodeExtension(1,0);else if(213===r)e=this.decodeExtension(2,0);else if(214===r)e=this.decodeExtension(4,0);else if(215===r)e=this.decodeExtension(8,0);else if(216===r)e=this.decodeExtension(16,0);else if(199===r){let t=this.lookU8();e=this.decodeExtension(t,1)}else if(200===r){let t=this.lookU16();e=this.decodeExtension(t,2)}else{if(201!==r)throw new o.DecodeError(`Unrecognized type byte: ${(0,t.prettyByte)(r)}`);{let t=this.lookU32();e=this.decodeExtension(t,4)}}this.complete();let i=this.stack;for(;i.length>0;){let t=i[i.length-1];if(0===t.type){if(t.array[t.position]=e,t.position++,t.position!==t.size)continue e;i.pop(),e=t.array}else{if(1===t.type){if(!l(e))throw new o.DecodeError("The type of key must be string or number but "+typeof e);if("__proto__"===e)throw new o.DecodeError("The key __proto__ is not allowed");t.key=e,t.type=2;continue e}if(t.map[t.key]=e,t.readCount++,t.readCount!==t.size){t.key=null,t.type=1;continue e}i.pop(),e=t.map}}return e}}readHeadByte(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new o.DecodeError(`Unrecognized array type byte: ${(0,t.prettyByte)(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new o.DecodeError(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})}pushArrayState(e){if(e>this.maxArrayLength)throw new o.DecodeError(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:0,size:e,array:new Array(e),position:0})}decodeUtf8String(e,t){var r;if(e>this.maxStrLength)throw new o.DecodeError(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw c;let i,n=this.pos+t;return i=this.stateIsMapKey()&&null!==(r=this.keyDecoder)&&void 0!==r&&r.canBeCached(e)?this.keyDecoder.decode(this.bytes,n,e):e>s.TEXT_DECODER_THRESHOLD?(0,s.utf8DecodeTD)(this.bytes,n,e):(0,s.utf8DecodeJs)(this.bytes,n,e),this.pos+=t+e,i}stateIsMapKey(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type}decodeBinary(e,t){if(e>this.maxBinLength)throw new o.DecodeError(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw c;let r=this.pos+t,i=this.bytes.subarray(r,r+e);return this.pos+=t+e,i}decodeExtension(e,t){if(e>this.maxExtLength)throw new o.DecodeError(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let r=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=(0,i.getUint64)(this.view,this.pos);return this.pos+=8,e}readI64(){let e=(0,i.getInt64)(this.view,this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}}}),fr=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeMulti=e.decode=e.defaultDecodeOptions=void 0;var t=bt();e.defaultDecodeOptions={},e.decode=function(r,i=e.defaultDecodeOptions){return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decode(r)},e.decodeMulti=function(r,i=e.defaultDecodeOptions){return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decodeMulti(r)}}),en=P(e=>{function t(e){return null!=e[Symbol.asyncIterator]}function r(e){if(null==e)throw new Error("Assertion Failure: value must not be null nor undefined")}async function*i(e){let t=e.getReader();try{for(;;){let{done:e,value:i}=await t.read();if(e)return;r(i),yield i}}finally{t.releaseLock()}}Object.defineProperty(e,"__esModule",{value:!0}),e.ensureAsyncIterable=e.asyncIterableFromStream=e.isAsyncIterable=void 0,e.isAsyncIterable=t,e.asyncIterableFromStream=i,e.ensureAsyncIterable=function(e){return t(e)?e:i(e)}}),rn=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=void 0;var t=bt(),r=en(),i=fr();function s(e,s=i.defaultDecodeOptions){let n=(0,r.ensureAsyncIterable)(e);return new t.Decoder(s.extensionCodec,s.context,s.maxStrLength,s.maxBinLength,s.maxArrayLength,s.maxMapLength,s.maxExtLength).decodeStream(n)}e.decodeAsync=async function(e,s=i.defaultDecodeOptions){let n=(0,r.ensureAsyncIterable)(e);return new t.Decoder(s.extensionCodec,s.context,s.maxStrLength,s.maxBinLength,s.maxArrayLength,s.maxMapLength,s.maxExtLength).decodeAsync(n)},e.decodeArrayStream=function(e,s=i.defaultDecodeOptions){let n=(0,r.ensureAsyncIterable)(e);return new t.Decoder(s.extensionCodec,s.context,s.maxStrLength,s.maxBinLength,s.maxArrayLength,s.maxMapLength,s.maxExtLength).decodeArrayStream(n)},e.decodeMultiStream=s,e.decodeStream=function(e,t=i.defaultDecodeOptions){return s(e,t)}}),Et=P(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeTimestampExtension=e.encodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimeSpecToTimestamp=e.encodeDateToTimeSpec=e.EXT_TIMESTAMP=e.ExtData=e.ExtensionCodec=e.Encoder=e.DataViewIndexOutOfBoundsError=e.DecodeError=e.Decoder=e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=e.decodeMulti=e.decode=e.encode=void 0;var t=Xr();Object.defineProperty(e,"encode",{enumerable:!0,get:function(){return t.encode}});var r=fr();Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return r.decode}}),Object.defineProperty(e,"decodeMulti",{enumerable:!0,get:function(){return r.decodeMulti}});var i=rn();Object.defineProperty(e,"decodeAsync",{enumerable:!0,get:function(){return i.decodeAsync}}),Object.defineProperty(e,"decodeArrayStream",{enumerable:!0,get:function(){return i.decodeArrayStream}}),Object.defineProperty(e,"decodeMultiStream",{enumerable:!0,get:function(){return i.decodeMultiStream}}),Object.defineProperty(e,"decodeStream",{enumerable:!0,get:function(){return i.decodeStream}});var s=bt();Object.defineProperty(e,"Decoder",{enumerable:!0,get:function(){return s.Decoder}}),Object.defineProperty(e,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return s.DataViewIndexOutOfBoundsError}});var n=dt();Object.defineProperty(e,"DecodeError",{enumerable:!0,get:function(){return n.DecodeError}});var a=lr();Object.defineProperty(e,"Encoder",{enumerable:!0,get:function(){return a.Encoder}});var o=ft();Object.defineProperty(e,"ExtensionCodec",{enumerable:!0,get:function(){return o.ExtensionCodec}});var l=sr();Object.defineProperty(e,"ExtData",{enumerable:!0,get:function(){return l.ExtData}});var h=or();Object.defineProperty(e,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return h.EXT_TIMESTAMP}}),Object.defineProperty(e,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return h.encodeDateToTimeSpec}}),Object.defineProperty(e,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return h.encodeTimeSpecToTimestamp}}),Object.defineProperty(e,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return h.decodeTimestampToTimeSpec}}),Object.defineProperty(e,"encodeTimestampExtension",{enumerable:!0,get:function(){return h.encodeTimestampExtension}}),Object.defineProperty(e,"decodeTimestampExtension",{enumerable:!0,get:function(){return h.decodeTimestampExtension}})}),io={};Bn(io,{Console:()=>Ht,Shelter:()=>rt,WebR:()=>tt,WebRChannelError:()=>k,WebRError:()=>M,WebRPayloadError:()=>F,WebRWorkerError:()=>Pe,isRCall:()=>$s,isRCharacter:()=>zs,isRComplex:()=>Hs,isRDouble:()=>Js,isREnvironment:()=>Fs,isRFunction:()=>Tr,isRInteger:()=>Vs,isRList:()=>Xs,isRLogical:()=>qs,isRNull:()=>Ns,isRObject:()=>m,isRPairlist:()=>Ls,isRRaw:()=>Gs,isRSymbol:()=>Bs}),module.exports=Ln(io);var Yt,M=class extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}},Pe=class extends M{},k=class extends M{},F=class extends M{},x=typeof process<"u"&&process.release&&"node"===process.release.name;if(globalThis.document)Yt=e=>new Promise((t,r)=>{let i=document.createElement("script");i.src=e,i.onload=()=>t(),i.onerror=r,document.head.appendChild(i)});else if(globalThis.importScripts)Yt=async e=>{try{globalThis.importScripts(e)}catch(t){if(!(t instanceof TypeError))throw t;await Promise.resolve().then(()=>Z(require(e)))}};else{if(!x)throw new M("Cannot determine runtime environment");Yt=async e=>{let t=(await Promise.resolve().then(()=>Z(require("path")))).default;await Promise.resolve().then(()=>Z(require(t.resolve(e))))}}function ae(){let e={resolve:e=>{},reject:e=>{},promise:null},t=new Promise((t,r)=>{e.resolve=t,e.reject=r});return e.promise=t,e}function Cr(e){return new Promise(t=>setTimeout(t,e))}function I(e,t,r,...i){return null===e||"object"!=typeof e?e:t(e)?r(e,...i):Array.isArray(e)||ArrayBuffer.isView(e)?e.map(e=>I(e,t,r,...i)):Object.fromEntries(Object.entries(e).map(([e,s],n)=>[e,I(s,t,r,...i)]))}function ot(e,t){let r=new XMLHttpRequest;r.open("get",e,!0),r.onload=()=>{let e=new Worker(URL.createObjectURL(new Blob([r.responseText])));t(e)},r.send()}function le(e){if(x)return!1;let t=new URL(location.href),r=new URL(e,location.origin);return!(t.host===r.host&&t.port===r.port&&t.protocol===r.protocol)}var Fn=new WeakMap;function jr(e,t){return Fn.set(e,t),e}var it=63;function at(){let e=Array.from({length:4},qn).join("-");if(e.length!==it)throw new Error("comlink internal error: UUID has the wrong length");return e}function qn(){let e=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16),t=15-e.length;return t>0&&(e=Array.from({length:t},()=>0).join("")+e),e}var an=Z(Et()),Ms=new TextEncoder;async function ln(e,t,r){try{let{taskId:i,sizeBuffer:s,dataBuffer:n,signalBuffer:a}=t,o=(0,an.encode)(r),l=o.length<=n.length;if(Atomics.store(s,0,o.length),Atomics.store(s,1,+l),!l){let[t,r]=Os(e);n.set(Ms.encode(t)),await on(a,i),n=(await r).dataBuffer}n.set(o),Atomics.store(s,1,1),await on(a,i)}catch(i){console.warn(i)}}function Os(e){let t=at();return[t,new Promise(r=>{x?e.once("message",e=>{!e.id||e.id!==t||r(e)}):e.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==t||(e.removeEventListener("message",i),r(s.data))}),e.start&&e.start()})]}async function on(e,t){let r=(t>>1)%32,i=1;for(;0!==Atomics.compareExchange(e,r+1,0,t);)await Cr(i),i<32&&(i*=2);Atomics.or(e,0,1<<r),Atomics.notify(e,0)}var N,B,Ae,gr,de=class{constructor(){u(this,Ae),u(this,N,void 0),u(this,B,void 0),h(this,B,[]),h(this,N,[])}reset(){h(this,B,[]),h(this,N,[])}put(e){i(this,B).length||v(this,Ae,gr).call(this),i(this,B).shift()(e)}async get(){return i(this,N).length||v(this,Ae,gr).call(this),i(this,N).shift()}isEmpty(){return!i(this,N).length}isBlocked(){return!!i(this,B).length}get length(){return i(this,N).length-i(this,B).length}};function Pt(e,t){return cn({type:"request",data:{uuid:at(),msg:e}},t)}function br(e,t,r){return cn({type:"response",data:{uuid:e,resp:t}},r)}function cn(e,t){return t&&jr(e,t),e}function un(e,t){return{type:"sync-request",data:{msg:e,reqData:t}}}function pn(e){let t=new Pe(e.obj.message);return"Error"!==e.obj.name&&(t.name=e.obj.name),t.stack=e.obj.stack,t}function Is(e){return e&&"object"==typeof e&&"payloadType"in e&&"obj"in e}function _t(e){return Is(e)&&"ptr"===e.payloadType}N=new WeakMap,B=new WeakMap,Ae=new WeakSet,gr=function(){i(this,N).push(new Promise(e=>{i(this,B).push(e)}))};var he,ye=class{constructor(){this.inputQueue=new de,this.outputQueue=new de,this.systemQueue=new de,u(this,he,new Map)}async read(){return await this.outputQueue.get()}async flush(){let e=[];for(;!this.outputQueue.isEmpty();)e.push(await this.read());return e}async readSystem(){return await this.systemQueue.get()}write(e){this.inputQueue.put(e)}async request(e,t){let r=Pt(e,t),{resolve:s,reject:n,promise:a}=ae();return i(this,he).set(r.data.uuid,{resolve:s,reject:n}),this.write(r),a}putClosedMessage(){this.outputQueue.put({type:"closed"})}resolveResponse(e){let t=e.data.uuid,r=i(this,he).get(t);if(r){let s=e.data.resp;i(this,he).delete(t),"err"===s.payloadType?r.reject(pn(s)):r.resolve(s)}else console.warn("Can't find request.")}};he=new WeakMap;var fe,Re,Me,Oe,me,hn=Z(Et()),Cs=new TextDecoder("utf-8"),kt=class{constructor(e,t,r=[]){u(this,fe,!1),u(this,Re,void 0),u(this,Me,void 0),u(this,Oe,void 0),u(this,me,void 0),this.syncifier=new wr,this.endpoint=e,this.msg=t,this.transfers=r,h(this,Re,!1)}scheduleSync(){if(!i(this,fe))return h(this,fe,!0),this.syncifier.scheduleTask(this),h(this,me,this.doSync()),i(this,me).next(),this}poll(){if(!i(this,fe))throw new Error("Task not synchronously scheduled");let{done:e,value:t}=i(this,me).next();return!!e&&(h(this,Re,!0),h(this,Me,t),!0)}*doSync(){let{endpoint:e,msg:t,transfers:r}=this,i=new Int32Array(new SharedArrayBuffer(8)),s=this.signalBuffer,n=this.taskId,a=dn(it),o=un(t,{sizeBuffer:i,dataBuffer:a,signalBuffer:s,taskId:n});if(e.postMessage(o,r),yield,0===Atomics.load(i,1)){let t=Cs.decode(a.slice(0,it));js(a),a=dn(Atomics.load(i,0)),e.postMessage({id:t,dataBuffer:a}),yield}let l=Atomics.load(i,0);return(0,hn.decode)(a.slice(0,l))}get result(){if(i(this,Oe))throw i(this,Oe);if(i(this,Re))return i(this,Me);throw new Error("Not ready.")}syncify(){return this.scheduleSync(),this.syncifier.syncifyTask(this),this.result}};fe=new WeakMap,Re=new WeakMap,Me=new WeakMap,Oe=new WeakMap,me=new WeakMap;var wr=class{constructor(){this.nextTaskId=new Int32Array([1]),this.signalBuffer=new Int32Array(new SharedArrayBuffer(132)),this.tasks=new Map}scheduleTask(e){e.taskId=this.nextTaskId[0],this.nextTaskId[0]+=2,e.signalBuffer=this.signalBuffer,this.tasks.set(e.taskId,e)}waitOnSignalBuffer(){for(;;)switch(Atomics.wait(this.signalBuffer,0,0,50)){case"ok":case"not-equal":return;case"timed-out":0!==xr[0]&&yn();break;default:throw new Error("Unreachable")}}*tasksIdsToWakeup(){let e=Atomics.load(this.signalBuffer,0);for(let t=0;t<32;t++){let r=1<<t;e&r&&(Atomics.and(this.signalBuffer,0,~r),yield Atomics.exchange(this.signalBuffer,t+1,0))}}pollTasks(e){let t=!1;for(let r of this.tasksIdsToWakeup()){let i=this.tasks.get(r);if(!i)throw new Error(`Assertion error: unknown taskId ${r}.`);i.poll()&&(this.tasks.delete(r),i===e&&(t=!0))}return t}syncifyTask(e){for(;;)if(this.waitOnSignalBuffer(),this.pollTasks(e))return}},St=[];function dn(e){let t=Math.ceil(Math.log2(e));St[t]||(St[t]=[]);let r=St[t].pop();return r?(r.fill(0),r):new Uint8Array(new SharedArrayBuffer(2**t))}function js(e){let t=Math.ceil(Math.log2(e.byteLength));St[t].push(e)}var xr=new Int32Array(new ArrayBuffer(4)),yn=()=>{throw xr[0]=0,new Error("Interrupted!")};function fn(e){yn=e}function Rn(e){xr=new Int32Array(e)}var l={};function mn(e){Object.keys(e).forEach(t=>l._free(e[t]))}x&&(globalThis.Worker=require("worker_threads").Worker);var ge,Dt,gn,Ue,Ie=class extends ye{constructor(e){super(),u(this,Dt),u(this,ge,void 0),this.close=()=>{},u(this,Ue,async(e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return h(this,ge,new Int32Array(t.data)),void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"sync-request":{let r=t,i=r.data.msg,s=r.data.reqData;switch(i.type){case"read":{let t=await this.inputQueue.get();await ln(e,s,t);break}default:throw new k(`Unsupported request type '${i.type}'.`)}return}case"request":throw new k("Can't send messages of type 'request' from a worker. Please Use 'sync-request' instead.")}});let t=t=>{v(this,Dt,gn).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()};let r={type:"init",data:{config:e,channelType:J.SharedArrayBuffer}};t.postMessage(r)};if(le(e.baseUrl))ot(`${e.baseUrl}webr-worker.js`,e=>t(e));else{let r=new Worker(`${e.baseUrl}webr-worker.js`);t(r)}({resolve:this.resolve,promise:this.initialised}=ae())}interrupt(){if(!i(this,ge))throw new k("Failed attempt to interrupt before initialising interruptBuffer");this.inputQueue.reset(),i(this,ge)[0]=1}};ge=new WeakMap,Dt=new WeakSet,gn=function(e){x?e.on("message",t=>{i(this,Ue).call(this,e,t)}):e.onmessage=t=>i(this,Ue).call(this,e,t.data)},Ue=new WeakMap;var ee,Ce,te,je,Er=class{constructor(){u(this,ee,void 0),u(this,Ce,()=>0),u(this,te,new Int32Array(new SharedArrayBuffer(4))),u(this,je,()=>{}),h(this,ee,x?require("worker_threads").parentPort:globalThis),Rn(i(this,te).buffer),fn(()=>this.handleInterrupt())}resolve(){this.write({type:"resolve",data:i(this,te).buffer})}write(e,t){i(this,ee).postMessage(e,t)}writeSystem(e,t){i(this,ee).postMessage({type:"system",data:e},t)}read(){return new kt(i(this,ee),{type:"read"}).syncify()}inputOrDispatch(){for(;;){let e=this.read();if("stdin"===e.type)return l.allocateUTF8(e.data);i(this,Ce).call(this,e)}}run(e){l.callMain(e)}setInterrupt(e){h(this,je,e)}handleInterrupt(){0!==i(this,te)[0]&&(i(this,te)[0]=0,i(this,je).call(this))}setDispatchHandler(e){h(this,Ce,e)}};ee=new WeakMap,Ce=new WeakMap,te=new WeakMap,je=new WeakMap;var Ot=Z(Et());x&&(globalThis.Worker=require("worker_threads").Worker);var be,re,we,Wt,bn,At,wn,Mt,xn,Be,Ne=class extends ye{constructor(e){super(),u(this,Wt),u(this,At),u(this,Mt),this.close=()=>{},u(this,be,new Map),u(this,re,void 0),u(this,we,!1),u(this,Be,async(e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"sync-request":{let e=t.data;return void i(this,be).set(e.data.uuid,e.data.msg)}case"request":throw new k("Can't send messages of type 'request' from a worker.Use service worker fetch request instead.")}});let t=t=>{v(this,Mt,xn).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()},v(this,Wt,bn).call(this,`${e.serviceWorkerUrl}webr-serviceworker.js`).then(r=>{let i={type:"init",data:{config:e,channelType:J.ServiceWorker,clientId:r,location:window.location.href}};t.postMessage(i)})};if(le(e.serviceWorkerUrl))ot(`${e.serviceWorkerUrl}webr-worker.js`,e=>t(e));else{let r=new Worker(`${e.serviceWorkerUrl}webr-worker.js`);t(r)}({resolve:this.resolve,promise:this.initialised}=ae())}activeRegistration(){var e;if(null==(e=i(this,re))||!e.active)throw new k("Attempted to obtain a non-existent active registration.");return i(this,re).active}interrupt(){h(this,we,!0)}};be=new WeakMap,re=new WeakMap,we=new WeakMap,Wt=new WeakSet,bn=async function(e){h(this,re,await navigator.serviceWorker.register(e)),await navigator.serviceWorker.ready,window.addEventListener("beforeunload",()=>{var e;null==(e=i(this,re))||e.unregister()});let t=await new Promise(e=>{navigator.serviceWorker.addEventListener("message",function t(r){"registration-successful"===r.data.type&&(navigator.serviceWorker.removeEventListener("message",t),e(r.data.clientId))}),this.activeRegistration().postMessage({type:"register-client-main"})});return navigator.serviceWorker.addEventListener("message",e=>{v(this,At,wn).call(this,e)}),t},At=new WeakSet,wn=async function(e){if("request"===e.data.type){let t=e.data.data,r=i(this,be).get(t);if(!r)throw new k("Request not found during service worker XHR request");switch(i(this,be).delete(t),r.type){case"read":{let e=await this.inputQueue.get();this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:br(t,e)});break}case"interrupt":{let e=i(this,we);this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:br(t,e)}),this.inputQueue.reset(),h(this,we,!1);break}default:throw new k(`Unsupported request type '${r.type}'.`)}return}},Mt=new WeakSet,xn=function(e){x?e.on("message",t=>{i(this,Be).call(this,e,t)}):e.onmessage=t=>i(this,Be).call(this,e,t.data)},Be=new WeakMap;var xe,Le,Fe,qe,Ve,Je,vr=class{constructor(e){if(u(this,xe,void 0),u(this,Le,void 0),u(this,Fe,void 0),u(this,qe,Date.now()),u(this,Ve,()=>0),u(this,Je,()=>{}),this.onMessageFromMainThread=()=>{},!e.clientId||!e.location)throw new k("Can't start service worker channel");h(this,Le,e.clientId),h(this,Fe,e.location),h(this,xe,x?require("worker_threads").parentPort:globalThis)}resolve(){this.write({type:"resolve"})}write(e,t){i(this,xe).postMessage(e,t)}writeSystem(e,t){i(this,xe).postMessage({type:"system",data:e},t)}syncRequest(e){let t=Pt(e);this.write({type:"sync-request",data:t});let r=0;for(;;)try{let e=new URL("__wasm__/webr-fetch-request/",i(this,Fe)),r=new XMLHttpRequest;r.timeout=6e4,r.responseType="arraybuffer",r.open("POST",e,!1);let s={clientId:i(this,Le),uuid:t.data.uuid};return r.send((0,Ot.encode)(s)),(0,Ot.decode)(r.response)}catch(s){if(!(s instanceof DOMException&&r++<1e3))throw s;console.log("Service worker request failed - resending request")}}read(){return this.syncRequest({type:"read"}).data.resp}inputOrDispatch(){for(;;){let e=this.read();if("stdin"===e.type)return l.allocateUTF8(e.data);i(this,Ve).call(this,e)}}run(e){l.callMain(e)}setInterrupt(e){h(this,Je,e)}handleInterrupt(){Date.now()>i(this,qe)+1e3&&(h(this,qe,Date.now()),this.syncRequest({type:"interrupt"}).data.resp&&i(this,Je).call(this))}setDispatchHandler(e){h(this,Ve,e)}};xe=new WeakMap,Le=new WeakMap,Fe=new WeakMap,qe=new WeakMap,Ve=new WeakMap,Je=new WeakMap;var J={Automatic:0,SharedArrayBuffer:1,ServiceWorker:2};function En(e){switch(e.channelType){case J.SharedArrayBuffer:return new Ie(e);case J.ServiceWorker:return new Ne(e);case J.Automatic:default:if(typeof SharedArrayBuffer<"u")return new Ie(e);if("serviceWorker"in navigator&&!le(e.serviceWorkerUrl))return new Ne(e);throw new k("Can't initialise main thread communication channel")}}var vn=x?__dirname+"/":"./",Tn="https://repo.r-wasm.org";function m(e){return e&&("object"==typeof e||"function"==typeof e)&&"payloadType"in e&&_t(e._payload)}function Ns(e){return m(e)&&"null"===e._payload.obj.type}function Bs(e){return m(e)&&"symbol"===e._payload.obj.type}function Ls(e){return m(e)&&"pairlist"===e._payload.obj.type}function Fs(e){return m(e)&&"environment"===e._payload.obj.type}function qs(e){return m(e)&&"logical"===e._payload.obj.type}function Vs(e){return m(e)&&"integer"===e._payload.obj.type}function Js(e){return m(e)&&"double"===e._payload.obj.type}function Hs(e){return m(e)&&"complex"===e._payload.obj.type}function zs(e){return m(e)&&"character"===e._payload.obj.type}function Xs(e){return m(e)&&"list"===e._payload.obj.type}function Gs(e){return m(e)&&"raw"===e._payload.obj.type}function $s(e){return m(e)&&"call"===e._payload.obj.type}function Tr(e){var t;return!(!m(e)||null==(t=e._payload.obj.methods)||!t.includes("exec"))}var f={null:0,symbol:1,pairlist:2,closure:3,environment:4,promise:5,call:6,special:7,builtin:8,string:9,logical:10,integer:13,double:14,complex:15,character:16,dots:17,any:18,list:19,expression:20,bytecode:21,pointer:22,weakref:23,raw:24,s4:25,new:30,free:31,function:99};function Pr(e){return e&&"object"==typeof e&&Object.keys(f).includes(e.type)}function _r(e){return e&&"object"==typeof e&&"re"in e&&"im"in e}function It(e){return l._Rf_protect(L(e)),e}function S(e,t){return l._Rf_protect(L(e)),++t.n,e}function Pn(e){let t=l._malloc(4);return l._R_ProtectWithIndex(L(e),t),{loc:l.getValue(t,"i32"),ptr:t}}function _n(e){l._Rf_unprotect(1),l._free(e.ptr)}function Sn(e,t){return l._R_Reprotect(L(e),t.loc),e}function W(e){l._Rf_unprotect(e)}function Sr(e,t,r){l._Rf_defineVar(L(t),L(r),L(e))}function kn(e,t){let r={},i={n:0};try{let s=new ze(t);S(s,i),r.code=l.allocateUTF8(e);let n=l._R_ParseEvalString(r.code,s.ptr);return y.wrap(n)}finally{mn(r),W(i.n)}}function He(e,t){return l.getWasmTableEntry(l.GOT.ffi_safe_eval.value)(L(e),L(t))}function L(e){return Ys(e)?e.ptr:e}function ie(e,t){if(l._TYPEOF(e.ptr)!==f[t])throw new Error(`Unexpected object type "${e.type()}" when expecting type "${t}"`)}function Qs(e){if(Pr(e))return new(Dn(f[e.type]))(e);if(e&&"object"==typeof e&&"type"in e&&"null"===e.type)return new Nt;if(null===e)return new se({type:"logical",names:null,values:[null]});if("boolean"==typeof e)return new se(e);if("number"==typeof e)return new Xe(e);if("string"==typeof e)return new X(e);if(_r(e))return new Ge(e);if(Array.isArray(e))return Zs(e);throw new Error("Robj construction for this JS object is not yet supported")}function Zs(e){let t={n:0};try{let r=new oe([new G("c"),...e]);return S(r,t),r.eval()}finally{W(t.n)}}var ve,Ut,E=class{constructor(e){this.ptr=e}type(){let e=l._TYPEOF(this.ptr);return Object.keys(f).find(t=>f[t]===e)}},ne=class extends E{constructor(e){if(!(e instanceof E))return Qs(e);super(e.ptr),u(this,ve)}static wrap(e){return new(Dn(l._TYPEOF(e)))(new E(e))}get[Symbol.toStringTag](){return`RObject:${this.type()}`}static getPersistentObject(e){return D[e]}getPropertyValue(e){return this[e]}inspect(){kn(".Internal(inspect(x))",{x:this})}isNull(){return l._TYPEOF(this.ptr)===f.null}isUnbound(){return this.ptr===D.unboundValue.ptr}attrs(){return Te.wrap(l._ATTRIB(this.ptr))}setNames(e){let t;if(null===e)t=D.null;else{if(!Array.isArray(e)||!e.every(e=>"string"==typeof e||null===e))throw new Error("Argument to setNames must be null or an Array of strings or null");t=new X(e)}return l._Rf_setAttrib(this.ptr,D.namesSymbol.ptr,t.ptr),this}names(){let e=X.wrap(l._Rf_getAttrib(this.ptr,D.namesSymbol.ptr));return e.isNull()?null:e.toArray()}includes(e){let t=this.names();return t&&t.includes(e)}toJs(e={depth:0},t=1){throw new Error("This R object cannot be converted to JS")}subset(e){return v(this,ve,Ut).call(this,e,D.bracketSymbol.ptr)}get(e){return v(this,ve,Ut).call(this,e,D.bracket2Symbol.ptr)}getDollar(e){return v(this,ve,Ut).call(this,e,D.dollarSymbol.ptr)}pluck(...e){let t=Pn(D.null);try{let r=(e,r)=>Sn(e.get(r),t),i=e.reduce(r,this);return i.isNull()?void 0:i}finally{_n(t)}}set(e,t){let r={n:0};try{let i=new ne(e);S(i,r);let s=new ne(t);S(s,r);let n=new G("[[<-"),a=l._Rf_lang4(n.ptr,this.ptr,i.ptr,s.ptr);return S(a,r),ne.wrap(He(a,D.baseEnv))}finally{W(r.n)}}static getMethods(e){let t=new Set,r=e;do{Object.getOwnPropertyNames(r).map(e=>t.add(e))}while(r=Object.getPrototypeOf(r));return[...t.keys()].filter(t=>"function"==typeof e[t])}},y=ne;ve=new WeakSet,Ut=function(e,t){let r={n:0};try{let i=new ne(e);S(i,r);let s=l._Rf_lang3(t,this.ptr,i.ptr);return S(s,r),ne.wrap(He(s,D.baseEnv))}finally{W(r.n)}};var Bt,Nt=class extends y{constructor(){return super(new E(l.getValue(l._R_NilValue,"*"))),this}toJs(){return{type:"null"}}},G=class extends y{constructor(e){if(e instanceof E)return ie(e,"symbol"),void super(e);let t=l.allocateUTF8(e);try{super(new E(l._Rf_install(t)))}finally{l._free(t)}}toJs(){let e=this.toObject();return{type:"symbol",printname:e.printname,symvalue:e.symvalue,internal:e.internal}}toObject(){return{printname:this.printname().isUnbound()?null:this.printname().toString(),symvalue:this.symvalue().isUnbound()?null:this.symvalue().ptr,internal:this.internal().isNull()?null:this.internal().ptr}}toString(){return this.printname().toString()}printname(){return $e.wrap(l._PRINTNAME(this.ptr))}symvalue(){return y.wrap(l._SYMVALUE(this.ptr))}internal(){return y.wrap(l._INTERNAL(this.ptr))}},Te=class extends y{constructor(e){if(e instanceof E)return ie(e,"pairlist"),super(e),this;let t={n:0};try{let{names:r,values:i}=Ke(e),s=Te.wrap(l._Rf_allocList(i.length));S(s,t);for(let[e,t]=[0,s];!t.isNull();[e,t]=[e+1,t.cdr()])t.setcar(new y(i[e]));s.setNames(r),super(s)}finally{W(t.n)}}get length(){return this.toArray().length}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=1}={}){let i=this.entries({depth:r}),s=i.map(([e,t])=>e);if(!e&&new Set(s).size!==s.length)throw new Error("Duplicate key when converting pairlist without allowDuplicateKey enabled");if(!t&&s.some(e=>!e))throw new Error("Empty or null key when converting pairlist without allowEmptyKey enabled");return Object.fromEntries(i.filter((e,t)=>i.findIndex(t=>t[0]===e[0])===t))}entries(e={depth:1}){let t=this.toJs(e);return t.values.map((e,r)=>[t.names?t.names[r]:null,e])}toJs(e={depth:0},t=1){let r=[],i=!1,s=[];for(let n=this;!n.isNull();n=n.cdr()){let a=n.tag();a.isNull()?r.push(""):(i=!0,r.push(a.toString())),e.depth&&t>=e.depth?s.push(n.car()):s.push(n.car().toJs(e,t+1))}return{type:"pairlist",names:i?r:null,values:s}}includes(e){return e in this.toObject()}setcar(e){l._SETCAR(this.ptr,e.ptr)}car(){return y.wrap(l._CAR(this.ptr))}cdr(){return y.wrap(l._CDR(this.ptr))}tag(){return y.wrap(l._TAG(this.ptr))}},oe=class extends y{constructor(e){if(e instanceof E)return ie(e,"call"),super(e),this;let t={n:0};try{let{values:r}=Ke(e),i=r.map(e=>S(new y(e),t)),s=oe.wrap(l._Rf_allocVector(f.call,r.length));S(s,t);for(let[e,t]=[0,s];!t.isNull();[e,t]=[e+1,t.cdr()])t.setcar(i[e]);super(s)}finally{W(t.n)}}setcar(e){l._SETCAR(this.ptr,e.ptr)}car(){return y.wrap(l._CAR(this.ptr))}cdr(){return y.wrap(l._CDR(this.ptr))}eval(){return y.wrap(He(this.ptr,D.baseEnv))}},kr=class extends y{constructor(e){if(e instanceof E)return ie(e,"list"),super(e),this;let t={n:0};try{let{names:r,values:i}=Ke(e),s=l._Rf_allocVector(f.list,i.length);S(s,t),i.forEach((e,t)=>{l._SET_VECTOR_ELT(s,t,new y(e).ptr)}),y.wrap(s).setNames(r),super(new E(s))}finally{W(t.n)}}get length(){return l._LENGTH(this.ptr)}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=1}={}){let i=this.entries({depth:r}),s=i.map(([e,t])=>e);if(!e&&new Set(s).size!==s.length)throw new Error("Duplicate key when converting list without allowDuplicateKey enabled");if(!t&&s.some(e=>!e))throw new Error("Empty or null key when converting list without allowEmptyKey enabled");return Object.fromEntries(i.filter((e,t)=>i.findIndex(t=>t[0]===e[0])===t))}entries(e={depth:1}){let t=this.toJs(e);return t.values.map((e,r)=>[t.names?t.names[r]:null,e])}toJs(e={depth:0},t=1){return{type:"list",names:this.names(),values:[...Array(this.length).keys()].map(r=>e.depth&&t>=e.depth?this.get(r+1):this.get(r+1).toJs(e,t+1))}}},Ee=class extends y{exec(...e){let t={n:0};try{let r=new oe([this,...e]);return S(r,t),r.eval()}finally{W(t.n)}}},$e=class extends y{constructor(e){if(e instanceof E)return ie(e,"string"),void super(e);let t=l.allocateUTF8(e);try{super(new E(l._Rf_mkChar(t)))}finally{l._free(t)}}toString(){return l.UTF8ToString(l._R_CHAR(this.ptr))}toJs(){return{type:"string",value:this.toString()}}},ze=class extends y{constructor(e={}){if(e instanceof E)return ie(e,"environment"),super(e),this;let t=0;try{let{names:r,values:i}=Ke(e),s=It(l._R_NewEnv(D.globalEnv.ptr,0,0));++t,i.forEach((e,t)=>{let i=r?r[t]:null;if(!i)throw new Error("Can't create object in new environment with empty symbol name");let n=new G(i),a=It(new y(e));try{Sr(s,n,a)}finally{W(1)}}),super(new E(s))}finally{W(t)}}ls(e=!1,t=!0){return X.wrap(l._R_lsInternal3(this.ptr,Number(e),Number(t))).toArray()}bind(e,t){let r=new G(e),i=It(new y(t));try{Sr(this,r,i)}finally{W(1)}}names(){return this.ls(!0,!0)}frame(){return y.wrap(l._FRAME(this.ptr))}subset(e){if("number"==typeof e)throw new Error("Object of type environment is not subsettable");return this.getDollar(e)}toObject({depth:e=0}={}){let t=this.names();return Object.fromEntries([...Array(t.length).keys()].map(r=>[t[r],this.getDollar(t[r]).toJs({depth:e})]))}toJs(e={depth:0},t=1){let r=this.names(),i=[...Array(r.length).keys()].map(i=>e.depth&&t>=e.depth?this.getDollar(r[i]):this.getDollar(r[i]).toJs(e,t+1));return{type:"environment",names:r,values:i}}},$=class extends y{constructor(e,t,r){if(e instanceof E)return ie(e,t),super(e),this;let i={n:0};try{let{names:s,values:n}=Ke(e),a=l._Rf_allocVector(f[t],n.length);S(a,i),n.forEach(r(a)),y.wrap(a).setNames(s),super(new E(a))}finally{W(i.n)}}get length(){return l._LENGTH(this.ptr)}get(e){return super.get(e)}subset(e){return super.subset(e)}getDollar(e){throw new Error("$ operator is invalid for atomic vectors")}detectMissing(){let e={n:0};try{let t=l._Rf_lang2(new G("is.na").ptr,this.ptr);S(t,e);let r=se.wrap(He(t,D.baseEnv));S(r,e);let i=r.toTypedArray();return Array.from(i).map(e=>!!e)}finally{W(e.n)}}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:e[r])}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1}={}){let r=this.entries(),i=r.map(([e,t])=>e);if(!e&&new Set(i).size!==i.length)throw new Error("Duplicate key when converting atomic vector without allowDuplicateKey enabled");if(!t&&i.some(e=>!e))throw new Error("Empty or null key when converting atomic vector without allowEmptyKey enabled");return Object.fromEntries(r.filter((e,t)=>r.findIndex(t=>t[0]===e[0])===t))}entries(){let e=this.toArray(),t=this.names();return e.map((e,r)=>[t?t[r]:null,e])}toJs(){return{type:this.type(),names:this.names(),values:this.toArray()}}},Dr=class extends ${constructor(e){super(e,"logical",i(Dr,Bt))}getBoolean(e){return this.get(e).toArray()[0]}toBoolean(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getBoolean(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS boolean");return e}toTypedArray(){return new Int32Array(l.HEAP32.subarray(l._LOGICAL(this.ptr)/4,l._LOGICAL(this.ptr)/4+this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:!!e[r])}},se=Dr;Bt=new WeakMap,u(se,Bt,e=>{let t=l._LOGICAL(e),r=l.getValue(l._R_NaInt,"i32");return(e,i)=>{l.setValue(t+4*i,null===e?r:!!e,"i32")}});var Lt,Wr=class extends ${constructor(e){super(e,"integer",i(Wr,Lt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Int32Array(l.HEAP32.subarray(l._INTEGER(this.ptr)/4,l._INTEGER(this.ptr)/4+this.length))}},Ct=Wr;Lt=new WeakMap,u(Ct,Lt,e=>{let t=l._INTEGER(e),r=l.getValue(l._R_NaInt,"i32");return(e,i)=>{l.setValue(t+4*i,null===e?r:Math.round(Number(e)),"i32")}});var Ft,Ar=class extends ${constructor(e){super(e,"double",i(Ar,Ft))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Float64Array(l.HEAPF64.subarray(l._REAL(this.ptr)/8,l._REAL(this.ptr)/8+this.length))}},Xe=Ar;Ft=new WeakMap,u(Xe,Ft,e=>{let t=l._REAL(e),r=l.getValue(l._R_NaReal,"double");return(e,i)=>{l.setValue(t+8*i,null===e?r:e,"double")}});var qt,Mr=class extends ${constructor(e){super(e,"complex",i(Mr,qt))}getComplex(e){return this.get(e).toArray()[0]}toComplex(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getComplex(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS object");return e}toTypedArray(){return new Float64Array(l.HEAPF64.subarray(l._COMPLEX(this.ptr)/8,l._COMPLEX(this.ptr)/8+2*this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:{re:e[2*r],im:e[2*r+1]})}},Ge=Mr;qt=new WeakMap,u(Ge,qt,e=>{let t=l._COMPLEX(e),r=l.getValue(l._R_NaReal,"double");return(e,i)=>{l.setValue(t+2*i*8,null===e?r:e.re,"double"),l.setValue(t+8*(2*i+1),null===e?r:e.im,"double")}});var Vt,Or=class extends ${constructor(e){super(e,"character",i(Or,Vt))}getString(e){return this.get(e).toArray()[0]}toString(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getString(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS string");return e}toTypedArray(){return new Uint32Array(l.HEAPU32.subarray(l._STRING_PTR(this.ptr)/4,l._STRING_PTR(this.ptr)/4+this.length))}toArray(){return this.detectMissing().map((e,t)=>e?null:l.UTF8ToString(l._R_CHAR(l._STRING_ELT(this.ptr,t))))}},X=Or;Vt=new WeakMap,u(X,Vt,e=>(t,r)=>{null===t?l._SET_STRING_ELT(e,r,D.naString.ptr):l._SET_STRING_ELT(e,r,new $e(t).ptr)});var Jt,D,Ir=class extends ${constructor(e){super(e,"raw",i(Ir,Jt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Uint8Array(l.HEAPU8.subarray(l._RAW(this.ptr),l._RAW(this.ptr)+this.length))}},jt=Ir;function Ke(e){return Pr(e)?e:Array.isArray(e)||ArrayBuffer.isView(e)?{names:null,values:e}:e&&"object"==typeof e&&!_r(e)?{names:Object.keys(e),values:Object.values(e)}:{names:null,values:[e]}}function Dn(e){let t={[f.null]:Nt,[f.symbol]:G,[f.pairlist]:Te,[f.closure]:Ee,[f.environment]:ze,[f.call]:oe,[f.special]:Ee,[f.builtin]:Ee,[f.string]:$e,[f.logical]:se,[f.integer]:Ct,[f.double]:Xe,[f.complex]:Ge,[f.character]:X,[f.list]:kr,[f.raw]:jt,[f.function]:Ee};return e in t?t[e]:y}function Ys(e){return e instanceof y}function to(){}function ro(e,t){return async function*(){let r={type:"callRObjectMethod",data:{payload:t._payload,prop:"getPropertyValue",args:[{payloadType:"raw",obj:"length"}],shelter:void 0}},i=await e.request(r);if("number"!=typeof i.obj)throw new M("Cannot iterate over object, unexpected type for length property.");for(let e=1;e<=i.obj;e++)yield t.get(e)}}function Wn(e,t,r){return async(...i)=>{let s=i.map(e=>m(e)?e._payload:{obj:I(e,m,e=>e._payload),payloadType:"raw"}),n={type:"callRObjectMethod",data:{payload:r,prop:t,args:s}},a=await e.request(n);switch(a.payloadType){case"ptr":return K(e,a);case"raw":return I(a,_t,(e,t)=>K(t,e),e).obj}}}async function no(e,t,r,i){let s={type:"newRObject",data:{objType:t,obj:I(i,m,e=>e._payload),shelter:r}},n=await e.request(s);switch(n.payloadType){case"raw":throw new F("Unexpected raw payload type returned from newRObject");case"ptr":return K(e,n)}}function K(e,t){var r;let i=new Proxy(null!=(r=t.obj.methods)&&r.includes("exec")?Object.assign(to,{...t}):t,{get:(r,s)=>{var n;return"_payload"===s?t:s===Symbol.asyncIterator?ro(e,i):null!=(n=t.obj.methods)&&n.includes(s.toString())?Wn(e,s.toString(),t):void 0},apply:async(r,i,s)=>{let n=await K(e,t).exec(...s);return Tr(n)?n:n.toJs()}});return i}function A(e,t,r){return new Proxy(y,{construct:(i,s)=>no(e,r,t,...s),get:(t,r)=>Wn(e,r.toString())})}Jt=new WeakMap,u(jt,Jt,e=>{let t=l._RAW(e);return(e,r)=>{l.setValue(t+r,Number(e),"i8")}});var Qe,Ze,Ye,et,zt,Xt,Gt,$t,Kt,An,Ht=class{constructor(e={},t={REnv:{R_HOME:"/usr/lib/R",FONTCONFIG_PATH:"/etc/fonts",R_ENABLE_JIT:"0"}}){u(this,Kt),u(this,Qe,void 0),u(this,Ze,void 0),u(this,Ye,void 0),u(this,et,void 0),u(this,zt,e=>{console.log(e)}),u(this,Xt,e=>{console.error(e)}),u(this,Gt,e=>{let t=prompt(e);t&&this.stdin(`${t}\n`)}),u(this,$t,e=>{if(x)throw new Error("Plotting with HTML canvas is not yet supported under Node");this.canvas.getContext("2d").drawImage(e,0,0)}),this.webR=new tt(t),x||(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width","1008"),this.canvas.setAttribute("height","1008")),h(this,Qe,e.stdout||i(this,zt)),h(this,Ze,e.stderr||i(this,Xt)),h(this,Ye,e.prompt||i(this,Gt)),h(this,et,e.canvasImage||i(this,$t)),this.webR.evalRVoid("options(device=webr::canvas)")}stdin(e){this.webR.writeConsole(e)}interrupt(){this.webR.interrupt()}run(){v(this,Kt,An).call(this)}};Qe=new WeakMap,Ze=new WeakMap,Ye=new WeakMap,et=new WeakMap,zt=new WeakMap,Xt=new WeakMap,Gt=new WeakMap,$t=new WeakMap,Kt=new WeakSet,An=async function(){for(;;){let e=await this.webR.read();switch(e.type){case"stdout":i(this,Qe).call(this,e.data);break;case"stderr":i(this,Ze).call(this,e.data);break;case"prompt":i(this,Ye).call(this,e.data);break;case"canvasImage":i(this,et).call(this,e.data.image);break;case"closed":return;default:console.warn(`Unhandled output type for webR Console: ${e.type}.`)}}};var b,Qt,On,so={FONTCONFIG_PATH:"/etc/fonts",R_HOME:"/usr/lib/R",R_ENABLE_JIT:"0"},Mn={RArgs:[],REnv:so,baseUrl:vn,serviceWorkerUrl:"",repoUrl:Tn,homedir:"/home/web_user",interactive:!0,channelType:J.Automatic,createLazyFilesystem:!0},tt=class{constructor(e={}){u(this,Qt),u(this,b,void 0),this.FS={lookupPath:async e=>{let t={type:"lookupPath",data:{path:e}};return(await i(this,b).request(t)).obj},mkdir:async e=>{let t={type:"mkdir",data:{path:e}};return(await i(this,b).request(t)).obj},readFile:async(e,t)=>{let r={type:"readFile",data:{path:e,flags:t}};return(await i(this,b).request(r)).obj},rmdir:async e=>{let t={type:"rmdir",data:{path:e}};await i(this,b).request(t)},writeFile:async(e,t,r)=>{let s={type:"writeFile",data:{path:e,data:t,flags:r}};await i(this,b).request(s)},unlink:async e=>{let t={type:"unlink",data:{path:e}};await i(this,b).request(t)}};let t={...Mn,...e,REnv:{...Mn.REnv,...e.REnv}};h(this,b,En(t)),this.objs={},this.Shelter=oo(i(this,b))}async init(){let e=await i(this,b).initialised;return this.globalShelter=await new this.Shelter,this.RObject=this.globalShelter.RObject,this.RLogical=this.globalShelter.RLogical,this.RInteger=this.globalShelter.RInteger,this.RDouble=this.globalShelter.RDouble,this.RComplex=this.globalShelter.RComplex,this.RCharacter=this.globalShelter.RCharacter,this.RRaw=this.globalShelter.RRaw,this.RList=this.globalShelter.RList,this.RPairlist=this.globalShelter.RPairlist,this.REnvironment=this.globalShelter.REnvironment,this.RSymbol=this.globalShelter.RSymbol,this.RString=this.globalShelter.RString,this.RCall=this.globalShelter.RCall,this.objs={baseEnv:await this.RObject.getPersistentObject("baseEnv"),globalEnv:await this.RObject.getPersistentObject("globalEnv"),null:await this.RObject.getPersistentObject("null"),true:await this.RObject.getPersistentObject("true"),false:await this.RObject.getPersistentObject("false"),na:await this.RObject.getPersistentObject("na")},v(this,Qt,On).call(this),e}close(){i(this,b).close()}async read(){return await i(this,b).read()}async flush(){return await i(this,b).flush()}write(e){i(this,b).write(e)}writeConsole(e){this.write({type:"stdin",data:e+"\n"})}interrupt(){i(this,b).interrupt()}async installPackages(e,t=!1){for(let r of e){let e={type:"installPackage",data:{name:r,quiet:t}};await i(this,b).request(e)}}async destroy(e){await this.globalShelter.destroy(e)}async evalR(e,t){return this.globalShelter.evalR(e,t)}async evalRVoid(e,t){return this.evalRRaw(e,"void",t)}async evalRBoolean(e,t){return this.evalRRaw(e,"boolean",t)}async evalRNumber(e,t){return this.evalRRaw(e,"number",t)}async evalRString(e,t){return this.evalRRaw(e,"string",t)}async evalRRaw(e,t,r={}){let s={type:"evalRRaw",data:{code:e,options:I(r,m,e=>e._payload),outputType:t}},n=await i(this,b).request(s);switch(n.payloadType){case"raw":return n.obj;case"ptr":throw new F("Unexpected ptr payload type returned from evalRVoid")}}async invokeWasmFunction(e,...t){let r={type:"invokeWasmFunction",data:{ptr:e,args:t}};return(await i(this,b).request(r)).obj}};b=new WeakMap,Qt=new WeakSet,On=async function(){for(;;){let e=await i(this,b).readSystem();switch(e.type){case"setTimeoutWasm":setTimeout((e,t)=>{this.invokeWasmFunction(e,...t)},e.data.delay,e.data.ptr,e.data.args);break;case"console.log":console.log(e.data);break;case"console.warn":console.warn(e.data);break;case"console.error":console.error(e.data);break;default:throw new M("Unknown system message type `"+e.type+"`")}}};var g,R,nt,rt=class{constructor(e){u(this,g,""),u(this,R,void 0),u(this,nt,!1),h(this,R,e)}async init(){if(i(this,nt))return;let e=await i(this,R).request({type:"newShelter"});h(this,g,e.obj),this.RObject=A(i(this,R),i(this,g),"object"),this.RLogical=A(i(this,R),i(this,g),"logical"),this.RInteger=A(i(this,R),i(this,g),"integer"),this.RDouble=A(i(this,R),i(this,g),"double"),this.RComplex=A(i(this,R),i(this,g),"complex"),this.RCharacter=A(i(this,R),i(this,g),"character"),this.RRaw=A(i(this,R),i(this,g),"raw"),this.RList=A(i(this,R),i(this,g),"list"),this.RPairlist=A(i(this,R),i(this,g),"pairlist"),this.REnvironment=A(i(this,R),i(this,g),"environment"),this.RSymbol=A(i(this,R),i(this,g),"symbol"),this.RString=A(i(this,R),i(this,g),"string"),this.RCall=A(i(this,R),i(this,g),"call"),h(this,nt,!0)}async purge(){let e={type:"shelterPurge",data:i(this,g)};await i(this,R).request(e)}async destroy(e){let t={type:"shelterDestroy",data:{id:i(this,g),obj:e._payload}};await i(this,R).request(t)}async size(){let e={type:"shelterSize",data:i(this,g)};return(await i(this,R).request(e)).obj}async evalR(e,t={}){let r={type:"evalR",data:{code:e,options:I(t,m,e=>e._payload),shelter:i(this,g)}},s=await i(this,R).request(r);if("raw"===s.payloadType)throw new F("Unexpected payload type returned from evalR");return K(i(this,R),s)}async captureR(e,t={}){let r={type:"captureR",data:{code:e,options:I(t,m,e=>e._payload),shelter:i(this,g)}},s=await i(this,R).request(r);switch(s.payloadType){case"ptr":throw new F("Unexpected payload type returned from evalR");case"raw":{let e=s.obj,t=K(i(this,R),e.result),r=e.output;for(let s=0;s<r.length;++s)"stdout"!==r[s].type&&"stderr"!==r[s].type&&(r[s].data=K(i(this,R),r[s].data));return{result:t,output:r}}}}};function oo(e){return new Proxy(rt,{construct:async()=>{let t=new rt(e);return await t.init(),t}})}g=new WeakMap,R=new WeakMap,nt=new WeakMap;