/*! For license information please see webr-worker.js.LICENSE.txt */
"use strict";var loadScript,__create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__copyProps=(e,t,r,n)=>{if(t&&"object"===typeof t||"function"===typeof t)for(let s of __getOwnPropNames(t))__hasOwnProp.call(e,s)||s===r||__defProp(e,s,{get:()=>t[s],enumerable:!(n=__getOwnPropDesc(t,s))||n.enumerable});return e},__toESM=(e,t,r)=>(r=null!=e?__create(__getProtoOf(e)):{},__copyProps(!t&&e&&e.__esModule?r:__defProp(r,"default",{value:e,enumerable:!0}),e)),__accessCheck=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},__privateGet=(e,t,r)=>(__accessCheck(e,t,"read from private field"),r?r.call(e):t.get(e)),__privateAdd=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},__privateSet=(e,t,r,n)=>(__accessCheck(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),__privateMethod=(e,t,r)=>(__accessCheck(e,t,"access private method"),r),require_int=__commonJS({"node_modules/@msgpack/msgpack/dist/utils/int.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getUint64=e.getInt64=e.setInt64=e.setUint64=e.UINT32_MAX=void 0,e.UINT32_MAX=4294967295,e.setUint64=function(e,t,r){const n=r/4294967296,s=r;e.setUint32(t,n),e.setUint32(t+4,s)},e.setInt64=function(e,t,r){const n=Math.floor(r/4294967296),s=r;e.setUint32(t,n),e.setUint32(t+4,s)},e.getInt64=function(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)},e.getUint64=function(e,t){return 4294967296*e.getUint32(t)+e.getUint32(t+4)}}}),require_utf8=__commonJS({"node_modules/@msgpack/msgpack/dist/utils/utf8.js"(e){var t,r,n;Object.defineProperty(e,"__esModule",{value:!0}),e.utf8DecodeTD=e.TEXT_DECODER_THRESHOLD=e.utf8DecodeJs=e.utf8EncodeTE=e.TEXT_ENCODER_THRESHOLD=e.utf8EncodeJs=e.utf8Count=void 0;var s=require_int(),o=("undefined"===typeof process||"never"!==(null===(t=null===process||void 0===process?void 0:process.env)||void 0===t?void 0:t.TEXT_ENCODING))&&"undefined"!==typeof TextEncoder&&"undefined"!==typeof TextDecoder;e.utf8Count=function(e){const t=e.length;let r=0,n=0;for(;n<t;){let s=e.charCodeAt(n++);if(0!==(4294967168&s))if(0===(4294965248&s))r+=2;else{if(s>=55296&&s<=56319&&n<t){const t=e.charCodeAt(n);56320===(64512&t)&&(++n,s=((1023&s)<<10)+(1023&t)+65536)}r+=0===(4294901760&s)?3:4}else r++}return r},e.utf8EncodeJs=function(e,t,r){const n=e.length;let s=r,o=0;for(;o<n;){let r=e.charCodeAt(o++);if(0!==(4294967168&r)){if(0===(4294965248&r))t[s++]=r>>6&31|192;else{if(r>=55296&&r<=56319&&o<n){const t=e.charCodeAt(o);56320===(64512&t)&&(++o,r=((1023&r)<<10)+(1023&t)+65536)}0===(4294901760&r)?(t[s++]=r>>12&15|224,t[s++]=r>>6&63|128):(t[s++]=r>>18&7|240,t[s++]=r>>12&63|128,t[s++]=r>>6&63|128)}t[s++]=63&r|128}else t[s++]=r}};var i=o?new TextEncoder:void 0;e.TEXT_ENCODER_THRESHOLD=o?"undefined"!==typeof process&&"force"!==(null===(r=null===process||void 0===process?void 0:process.env)||void 0===r?void 0:r.TEXT_ENCODING)?200:0:s.UINT32_MAX,e.utf8EncodeTE=(null===i||void 0===i?void 0:i.encodeInto)?function(e,t,r){i.encodeInto(e,t.subarray(r))}:function(e,t,r){t.set(i.encode(e),r)};e.utf8DecodeJs=function(e,t,r){let n=t;const s=n+r,o=[];let i="";for(;n<s;){const t=e[n++];if(0===(128&t))o.push(t);else if(192===(224&t)){const r=63&e[n++];o.push((31&t)<<6|r)}else if(224===(240&t)){const r=63&e[n++],s=63&e[n++];o.push((31&t)<<12|r<<6|s)}else if(240===(248&t)){let r=(7&t)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++];r>65535&&(r-=65536,o.push(r>>>10&1023|55296),r=56320|1023&r),o.push(r)}else o.push(t);o.length>=4096&&(i+=String.fromCharCode(...o),o.length=0)}return o.length>0&&(i+=String.fromCharCode(...o)),i};var a=o?new TextDecoder:null;e.TEXT_DECODER_THRESHOLD=o?"undefined"!==typeof process&&"force"!==(null===(n=null===process||void 0===process?void 0:process.env)||void 0===n?void 0:n.TEXT_DECODER)?200:0:s.UINT32_MAX,e.utf8DecodeTD=function(e,t,r){const n=e.subarray(t,t+r);return a.decode(n)}}}),require_ExtData=__commonJS({"node_modules/@msgpack/msgpack/dist/ExtData.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExtData=void 0;e.ExtData=class{constructor(e,t){this.type=e,this.data=t}}}}),require_DecodeError=__commonJS({"node_modules/@msgpack/msgpack/dist/DecodeError.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DecodeError=void 0;var t=class extends Error{constructor(e){super(e);const r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};e.DecodeError=t}}),require_timestamp=__commonJS({"node_modules/@msgpack/msgpack/dist/timestamp.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.timestampExtension=e.decodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimestampExtension=e.encodeDateToTimeSpec=e.encodeTimeSpecToTimestamp=e.EXT_TIMESTAMP=void 0;var t=require_DecodeError(),r=require_int();e.EXT_TIMESTAMP=-1;function n({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=17179869183){if(0===t&&e<=4294967295){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}{const r=e/4294967296,n=4294967295&e,s=new Uint8Array(8),o=new DataView(s.buffer);return o.setUint32(0,t<<2|3&r),o.setUint32(4,n),s}}{const n=new Uint8Array(12),s=new DataView(n.buffer);return s.setUint32(0,t),(0,r.setInt64)(s,4,e),n}}function s(e){const t=e.getTime(),r=Math.floor(t/1e3),n=1e6*(t-1e3*r),s=Math.floor(n/1e9);return{sec:r+s,nsec:n-1e9*s}}function o(e){if(e instanceof Date){return n(s(e))}return null}function i(e){const n=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:n.getUint32(0),nsec:0};case 8:{const e=n.getUint32(0);return{sec:4294967296*(3&e)+n.getUint32(4),nsec:e>>>2}}case 12:return{sec:(0,r.getInt64)(n,4),nsec:n.getUint32(0)};default:throw new t.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function a(e){const t=i(e);return new Date(1e3*t.sec+t.nsec/1e6)}e.encodeTimeSpecToTimestamp=n,e.encodeDateToTimeSpec=s,e.encodeTimestampExtension=o,e.decodeTimestampToTimeSpec=i,e.decodeTimestampExtension=a,e.timestampExtension={type:e.EXT_TIMESTAMP,encode:o,decode:a}}}),require_ExtensionCodec=__commonJS({"node_modules/@msgpack/msgpack/dist/ExtensionCodec.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionCodec=void 0;var t=require_ExtData(),r=require_timestamp(),n=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(r.timestampExtension)}register({type:e,encode:t,decode:r}){if(e>=0)this.encoders[e]=t,this.decoders[e]=r;else{const n=1+e;this.builtInEncoders[n]=t,this.builtInDecoders[n]=r}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const s=this.builtInEncoders[n];if(null!=s){const o=s(e,r);if(null!=o){const e=-1-n;return new t.ExtData(e,o)}}}for(let n=0;n<this.encoders.length;n++){const s=this.encoders[n];if(null!=s){const o=s(e,r);if(null!=o){const e=n;return new t.ExtData(e,o)}}}return e instanceof t.ExtData?e:null}decode(e,r,n){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,n):new t.ExtData(r,e)}};e.ExtensionCodec=n,n.defaultCodec=new n}}),require_typedArrays=__commonJS({"node_modules/@msgpack/msgpack/dist/utils/typedArrays.js"(e){function t(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.createDataView=e.ensureUint8Array=void 0,e.ensureUint8Array=t,e.createDataView=function(e){if(e instanceof ArrayBuffer)return new DataView(e);const r=t(e);return new DataView(r.buffer,r.byteOffset,r.byteLength)}}}),require_Encoder=__commonJS({"node_modules/@msgpack/msgpack/dist/Encoder.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Encoder=e.DEFAULT_INITIAL_BUFFER_SIZE=e.DEFAULT_MAX_DEPTH=void 0;var t=require_utf8(),r=require_ExtensionCodec(),n=require_int(),s=require_typedArrays();e.DEFAULT_MAX_DEPTH=100,e.DEFAULT_INITIAL_BUFFER_SIZE=2048;e.Encoder=class{constructor(t=r.ExtensionCodec.defaultCodec,n=void 0,s=e.DEFAULT_MAX_DEPTH,o=e.DEFAULT_INITIAL_BUFFER_SIZE,i=!1,a=!1,c=!1,l=!1){this.extensionCodec=t,this.context=n,this.maxDepth=s,this.initialBufferSize=o,this.sortKeys=i,this.forceFloat32=a,this.ignoreUndefined=c,this.forceIntegerToFloat=l,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}encode(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"===typeof e?this.encodeBoolean(e):"number"===typeof e?this.encodeNumber(e):"string"===typeof e?this.encodeString(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){const t=new ArrayBuffer(e),r=new Uint8Array(t),n=new DataView(t);r.set(this.bytes),this.view=n,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error(`Too long string: ${e} bytes in UTF-8`);this.writeU8(219),this.writeU32(e)}}encodeString(e){if(e.length>t.TEXT_ENCODER_THRESHOLD){const r=(0,t.utf8Count)(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),(0,t.utf8EncodeTE)(e,this.bytes,this.pos),this.pos+=r}else{const r=(0,t.utf8Count)(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),(0,t.utf8EncodeJs)(e,this.bytes,this.pos),this.pos+=r}}encodeObject(e,t){const r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!==typeof e)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`);this.encodeMap(e,t)}}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large binary: ${t}`);this.writeU8(198),this.writeU32(t)}const r=(0,s.ensureUint8Array)(e);this.writeU8a(r)}encodeArray(e,t){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error(`Too large array: ${r}`);this.writeU8(221),this.writeU32(r)}for(const n of e)this.doEncode(n,t+1)}countWithoutUndefined(e,t){let r=0;for(const n of t)void 0!==e[n]&&r++;return r}encodeMap(e,t){const r=Object.keys(e);this.sortKeys&&r.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else{if(!(n<4294967296))throw new Error(`Too large map object: ${n}`);this.writeU8(223),this.writeU32(n)}for(const s of r){const r=e[s];this.ignoreUndefined&&void 0===r||(this.encodeString(s),this.doEncode(r,t+1))}}encodeExtension(e){const t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large extension object: ${t}`);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),(0,n.setUint64)(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),(0,n.setInt64)(this.view,this.pos,e),this.pos+=8}}}}),require_encode=__commonJS({"node_modules/@msgpack/msgpack/dist/encode.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var t=require_Encoder(),r={};e.encode=function(e,n=r){return new t.Encoder(n.extensionCodec,n.context,n.maxDepth,n.initialBufferSize,n.sortKeys,n.forceFloat32,n.ignoreUndefined,n.forceIntegerToFloat).encodeSharedRef(e)}}}),require_prettyByte=__commonJS({"node_modules/@msgpack/msgpack/dist/utils/prettyByte.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.prettyByte=void 0,e.prettyByte=function(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}}}),require_CachedKeyDecoder=__commonJS({"node_modules/@msgpack/msgpack/dist/CachedKeyDecoder.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CachedKeyDecoder=void 0;var t=require_utf8();e.CachedKeyDecoder=class{constructor(e=16,t=16){this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,r){const n=this.caches[r-1];e:for(const s of n){const n=s.bytes;for(let s=0;s<r;s++)if(n[s]!==e[t+s])continue e;return s.str}return null}store(e,t){const r=this.caches[e.length-1],n={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=n:r.push(n)}decode(e,r,n){const s=this.find(e,r,n);if(null!=s)return this.hit++,s;this.miss++;const o=(0,t.utf8DecodeJs)(e,r,n),i=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(i,o),o}}}}),require_Decoder=__commonJS({"node_modules/@msgpack/msgpack/dist/Decoder.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.DataViewIndexOutOfBoundsError=void 0;var t=require_prettyByte(),r=require_ExtensionCodec(),n=require_int(),s=require_utf8(),o=require_typedArrays(),i=require_CachedKeyDecoder(),a=require_DecodeError(),c=e=>{const t=typeof e;return"string"===t||"number"===t},l=new DataView(new ArrayBuffer(0)),u=new Uint8Array(l.buffer);e.DataViewIndexOutOfBoundsError=(()=>{try{l.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")})();var d=new e.DataViewIndexOutOfBoundsError("Insufficient data"),p=new i.CachedKeyDecoder;e.Decoder=class{constructor(e=r.ExtensionCodec.defaultCodec,t=void 0,s=n.UINT32_MAX,o=n.UINT32_MAX,i=n.UINT32_MAX,a=n.UINT32_MAX,c=n.UINT32_MAX,d=p){this.extensionCodec=e,this.context=t,this.maxStrLength=s,this.maxBinLength=o,this.maxArrayLength=i,this.maxMapLength=a,this.maxExtLength=c,this.keyDecoder=d,this.totalPos=0,this.pos=0,this.view=l,this.bytes=u,this.headByte=-1,this.stack=[]}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.length=0}setBuffer(e){this.bytes=(0,o.ensureUint8Array)(e),this.view=(0,o.createDataView)(this.bytes),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){const t=this.bytes.subarray(this.pos),r=(0,o.ensureUint8Array)(e),n=new Uint8Array(t.length+r.length);n.set(t),n.set(r,t.length),this.setBuffer(n)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:r}=this;return new RangeError(`Extra ${t.byteLength-r} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}*decodeMulti(e){for(this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}async decodeAsync(r){let n,s=!1;for await(const t of r){if(s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(t);try{n=this.doDecodeSync(),s=!0}catch(c){if(!(c instanceof e.DataViewIndexOutOfBoundsError))throw c}this.totalPos+=this.pos}if(s){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:o,pos:i,totalPos:a}=this;throw new RangeError(`Insufficient data in parsing ${(0,t.prettyByte)(o)} at ${a} (${i} in the current buffer)`)}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(t,r){let n=r,s=-1;for await(const i of t){if(r&&0===s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),0!==--s;);}catch(o){if(!(o instanceof e.DataViewIndexOutOfBoundsError))throw o}this.totalPos+=this.pos}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const t=e-128;if(0!==t){this.pushMapState(t),this.complete();continue e}r={}}else if(e<160){const t=e-144;if(0!==t){this.pushArrayState(t),this.complete();continue e}r=[]}else{const t=e-160;r=this.decodeUtf8String(t,0)}else if(192===e)r=null;else if(194===e)r=!1;else if(195===e)r=!0;else if(202===e)r=this.readF32();else if(203===e)r=this.readF64();else if(204===e)r=this.readU8();else if(205===e)r=this.readU16();else if(206===e)r=this.readU32();else if(207===e)r=this.readU64();else if(208===e)r=this.readI8();else if(209===e)r=this.readI16();else if(210===e)r=this.readI32();else if(211===e)r=this.readI64();else if(217===e){const e=this.lookU8();r=this.decodeUtf8String(e,1)}else if(218===e){const e=this.lookU16();r=this.decodeUtf8String(e,2)}else if(219===e){const e=this.lookU32();r=this.decodeUtf8String(e,4)}else if(220===e){const e=this.readU16();if(0!==e){this.pushArrayState(e),this.complete();continue e}r=[]}else if(221===e){const e=this.readU32();if(0!==e){this.pushArrayState(e),this.complete();continue e}r=[]}else if(222===e){const e=this.readU16();if(0!==e){this.pushMapState(e),this.complete();continue e}r={}}else if(223===e){const e=this.readU32();if(0!==e){this.pushMapState(e),this.complete();continue e}r={}}else if(196===e){const e=this.lookU8();r=this.decodeBinary(e,1)}else if(197===e){const e=this.lookU16();r=this.decodeBinary(e,2)}else if(198===e){const e=this.lookU32();r=this.decodeBinary(e,4)}else if(212===e)r=this.decodeExtension(1,0);else if(213===e)r=this.decodeExtension(2,0);else if(214===e)r=this.decodeExtension(4,0);else if(215===e)r=this.decodeExtension(8,0);else if(216===e)r=this.decodeExtension(16,0);else if(199===e){const e=this.lookU8();r=this.decodeExtension(e,1)}else if(200===e){const e=this.lookU16();r=this.decodeExtension(e,2)}else{if(201!==e)throw new a.DecodeError(`Unrecognized type byte: ${(0,t.prettyByte)(e)}`);{const e=this.lookU32();r=this.decodeExtension(e,4)}}this.complete();const n=this.stack;for(;n.length>0;){const e=n[n.length-1];if(0===e.type){if(e.array[e.position]=r,e.position++,e.position!==e.size)continue e;n.pop(),r=e.array}else{if(1===e.type){if(!c(r))throw new a.DecodeError("The type of key must be string or number but "+typeof r);if("__proto__"===r)throw new a.DecodeError("The key __proto__ is not allowed");e.key=r,e.type=2;continue e}if(e.map[e.key]=r,e.readCount++,e.readCount!==e.size){e.key=null,e.type=1;continue e}n.pop(),r=e.map}}return r}}readHeadByte(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new a.DecodeError(`Unrecognized array type byte: ${(0,t.prettyByte)(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new a.DecodeError(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})}pushArrayState(e){if(e>this.maxArrayLength)throw new a.DecodeError(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:0,size:e,array:new Array(e),position:0})}decodeUtf8String(e,t){var r;if(e>this.maxStrLength)throw new a.DecodeError(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw d;const n=this.pos+t;let o;return o=this.stateIsMapKey()&&(null===(r=this.keyDecoder)||void 0===r?void 0:r.canBeCached(e))?this.keyDecoder.decode(this.bytes,n,e):e>s.TEXT_DECODER_THRESHOLD?(0,s.utf8DecodeTD)(this.bytes,n,e):(0,s.utf8DecodeJs)(this.bytes,n,e),this.pos+=t+e,o}stateIsMapKey(){if(this.stack.length>0){return 1===this.stack[this.stack.length-1].type}return!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new a.DecodeError(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw d;const r=this.pos+t,n=this.bytes.subarray(r,r+e);return this.pos+=t+e,n}decodeExtension(e,t){if(e>this.maxExtLength)throw new a.DecodeError(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+t),n=this.decodeBinary(e,t+1);return this.extensionCodec.decode(n,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=(0,n.getUint64)(this.view,this.pos);return this.pos+=8,e}readI64(){const e=(0,n.getInt64)(this.view,this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}}}),require_decode=__commonJS({"node_modules/@msgpack/msgpack/dist/decode.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodeMulti=e.decode=e.defaultDecodeOptions=void 0;var t=require_Decoder();e.defaultDecodeOptions={},e.decode=function(r,n=e.defaultDecodeOptions){return new t.Decoder(n.extensionCodec,n.context,n.maxStrLength,n.maxBinLength,n.maxArrayLength,n.maxMapLength,n.maxExtLength).decode(r)},e.decodeMulti=function(r,n=e.defaultDecodeOptions){return new t.Decoder(n.extensionCodec,n.context,n.maxStrLength,n.maxBinLength,n.maxArrayLength,n.maxMapLength,n.maxExtLength).decodeMulti(r)}}}),require_stream=__commonJS({"node_modules/@msgpack/msgpack/dist/utils/stream.js"(e){function t(e){return null!=e[Symbol.asyncIterator]}function r(e){if(null==e)throw new Error("Assertion Failure: value must not be null nor undefined")}async function*n(e){const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)return;r(n),yield n}}finally{t.releaseLock()}}Object.defineProperty(e,"__esModule",{value:!0}),e.ensureAsyncIterable=e.asyncIterableFromStream=e.isAsyncIterable=void 0,e.isAsyncIterable=t,e.asyncIterableFromStream=n,e.ensureAsyncIterable=function(e){return t(e)?e:n(e)}}}),require_decodeAsync=__commonJS({"node_modules/@msgpack/msgpack/dist/decodeAsync.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=void 0;var t=require_Decoder(),r=require_stream(),n=require_decode();function s(e,s=n.defaultDecodeOptions){const o=(0,r.ensureAsyncIterable)(e);return new t.Decoder(s.extensionCodec,s.context,s.maxStrLength,s.maxBinLength,s.maxArrayLength,s.maxMapLength,s.maxExtLength).decodeStream(o)}e.decodeAsync=async function(e,s=n.defaultDecodeOptions){const o=(0,r.ensureAsyncIterable)(e);return new t.Decoder(s.extensionCodec,s.context,s.maxStrLength,s.maxBinLength,s.maxArrayLength,s.maxMapLength,s.maxExtLength).decodeAsync(o)},e.decodeArrayStream=function(e,s=n.defaultDecodeOptions){const o=(0,r.ensureAsyncIterable)(e);return new t.Decoder(s.extensionCodec,s.context,s.maxStrLength,s.maxBinLength,s.maxArrayLength,s.maxMapLength,s.maxExtLength).decodeArrayStream(o)},e.decodeMultiStream=s,e.decodeStream=function(e,t=n.defaultDecodeOptions){return s(e,t)}}}),require_dist=__commonJS({"node_modules/@msgpack/msgpack/dist/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodeTimestampExtension=e.encodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimeSpecToTimestamp=e.encodeDateToTimeSpec=e.EXT_TIMESTAMP=e.ExtData=e.ExtensionCodec=e.Encoder=e.DataViewIndexOutOfBoundsError=e.DecodeError=e.Decoder=e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=e.decodeMulti=e.decode=e.encode=void 0;var t=require_encode();Object.defineProperty(e,"encode",{enumerable:!0,get:function(){return t.encode}});var r=require_decode();Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return r.decode}}),Object.defineProperty(e,"decodeMulti",{enumerable:!0,get:function(){return r.decodeMulti}});var n=require_decodeAsync();Object.defineProperty(e,"decodeAsync",{enumerable:!0,get:function(){return n.decodeAsync}}),Object.defineProperty(e,"decodeArrayStream",{enumerable:!0,get:function(){return n.decodeArrayStream}}),Object.defineProperty(e,"decodeMultiStream",{enumerable:!0,get:function(){return n.decodeMultiStream}}),Object.defineProperty(e,"decodeStream",{enumerable:!0,get:function(){return n.decodeStream}});var s=require_Decoder();Object.defineProperty(e,"Decoder",{enumerable:!0,get:function(){return s.Decoder}}),Object.defineProperty(e,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return s.DataViewIndexOutOfBoundsError}});var o=require_DecodeError();Object.defineProperty(e,"DecodeError",{enumerable:!0,get:function(){return o.DecodeError}});var i=require_Encoder();Object.defineProperty(e,"Encoder",{enumerable:!0,get:function(){return i.Encoder}});var a=require_ExtensionCodec();Object.defineProperty(e,"ExtensionCodec",{enumerable:!0,get:function(){return a.ExtensionCodec}});var c=require_ExtData();Object.defineProperty(e,"ExtData",{enumerable:!0,get:function(){return c.ExtData}});var l=require_timestamp();Object.defineProperty(e,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return l.EXT_TIMESTAMP}}),Object.defineProperty(e,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return l.encodeDateToTimeSpec}}),Object.defineProperty(e,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return l.encodeTimeSpecToTimestamp}}),Object.defineProperty(e,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return l.decodeTimestampToTimeSpec}}),Object.defineProperty(e,"encodeTimestampExtension",{enumerable:!0,get:function(){return l.encodeTimestampExtension}}),Object.defineProperty(e,"decodeTimestampExtension",{enumerable:!0,get:function(){return l.decodeTimestampExtension}})}}),require_XMLHttpRequest=__commonJS({"node_modules/xmlhttprequest-ssl/lib/XMLHttpRequest.js"(e,t){var r=require("fs"),n=require("url"),s=require("child_process").spawn;function o(e){e=e||{};var t,o,i=this,a=require("http"),c=require("https"),l={},u=!1,d={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},p=Object.assign({},d),h=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],f=["TRACE","TRACK","CONNECT"],_=!1,y=!1,w=!1,m={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),this.status=null,this.statusText=null;this.open=function(e,t,r,n,s){if(this.abort(),y=!1,w=!1,!function(e){return e&&-1===f.indexOf(e)}(e))throw new Error("SecurityError: Request method not allowed");l={method:e,url:t.toString(),async:"boolean"!==typeof r||r,user:n||null,password:s||null},g(this.OPENED)},this.setDisableHeaderCheck=function(e){u=e},this.setRequestHeader=function(e,t){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!function(e){return u||e&&-1===h.indexOf(e.toLowerCase())}(e))return console.warn('Refused to set unsafe header "'+e+'"'),!1;if(_)throw new Error("INVALID_STATE_ERR: send flag is true");return p[e]=t,!0},this.getResponseHeader=function(e){return"string"===typeof e&&this.readyState>this.OPENED&&o.headers[e.toLowerCase()]&&!y?o.headers[e.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||y)return"";var e="";for(var t in o.headers)"set-cookie"!==t&&"set-cookie2"!==t&&(e+=t+": "+o.headers[t]+"\r\n");return e.substr(0,e.length-2)},this.getRequestHeader=function(e){return"string"===typeof e&&p[e]?p[e]:""},this.send=function(u){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(_)throw new Error("INVALID_STATE_ERR: send has already been called");var d,h=!1,f=!1,w=n.parse(l.url);switch(w.protocol){case"https:":h=!0;case"http:":d=w.hostname;break;case"file:":f=!0;break;case void 0:case"":d="localhost";break;default:throw new Error("Protocol not supported.")}if(f){if("GET"!==l.method)throw new Error("XMLHttpRequest: Only GET method is supported");if(l.async)r.readFile(unescape(w.pathname),function(e,t){e?i.handleError(e,e.errno||-1):(i.status=200,i.responseText=t.toString("utf8"),i.response=t,g(i.DONE))});else try{this.response=r.readFileSync(unescape(w.pathname)),this.responseText=this.response.toString("utf8"),this.status=200,g(i.DONE)}catch(x){this.handleError(x,x.errno||-1)}}else{var m=w.port||(h?443:80),b=w.pathname+(w.search?w.search:"");if(p.Host=d,h&&443===m||80===m||(p.Host+=":"+w.port),l.user){"undefined"==typeof l.password&&(l.password="");var v=new Buffer(l.user+":"+l.password);p.Authorization="Basic "+v.toString("base64")}"GET"===l.method||"HEAD"===l.method?u=null:u?(p["Content-Length"]=Buffer.isBuffer(u)?u.length:Buffer.byteLength(u),p["Content-Type"]||(p["Content-Type"]="text/plain;charset=UTF-8")):"POST"===l.method&&(p["Content-Length"]=0);var E=e.agent||!1,R={host:d,port:m,path:b,method:l.method,headers:p,agent:E};if(h&&(R.pfx=e.pfx,R.key=e.key,R.passphrase=e.passphrase,R.cert=e.cert,R.ca=e.ca,R.ciphers=e.ciphers,R.rejectUnauthorized=!1!==e.rejectUnauthorized),y=!1,l.async){var S=h?c.request:a.request;_=!0,i.dispatchEvent("readystatechange");var M=function(r){if(302===(o=r).statusCode||303===o.statusCode||307===o.statusCode){l.url=o.headers.location;var s=n.parse(l.url);d=s.hostname;var a={hostname:s.hostname,port:s.port,path:s.path,method:303===o.statusCode?"GET":l.method,headers:p};return h&&(a.pfx=e.pfx,a.key=e.key,a.passphrase=e.passphrase,a.cert=e.cert,a.ca=e.ca,a.ciphers=e.ciphers,a.rejectUnauthorized=!1!==e.rejectUnauthorized),void(t=S(a,M).on("error",T)).end()}g(i.HEADERS_RECEIVED),i.status=o.statusCode,o.on("data",function(e){if(e){var t=Buffer.from(e);i.responseText+=t.toString("utf8"),i.response=Buffer.concat([i.response,t])}_&&g(i.LOADING)}),o.on("end",function(){_&&(_=!1,g(i.DONE))}),o.on("error",function(e){i.handleError(e)})},T=function(e){i.handleError(e)};t=S(R,M).on("error",T),e.autoUnref&&t.on("socket",e=>{e.unref()}),u&&t.write(u),t.end(),i.dispatchEvent("loadstart")}else{var k=".node-xmlhttprequest-content-"+process.pid,O=".node-xmlhttprequest-sync-"+process.pid;r.writeFileSync(O,"","utf8");for(var A="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(h?"s":"")+".request;var options = "+JSON.stringify(R)+";var responseText = '';var responseData = Buffer.alloc(0);var req = doRequest(options, function(response) {response.on('data', function(chunk) {  var data = Buffer.from(chunk);  responseText += data.toString('utf8');  responseData = Buffer.concat([responseData, data]);});response.on('end', function() {fs.writeFileSync('"+k+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText, data: responseData.toString('base64')}}), 'utf8');fs.unlinkSync('"+O+"');});response.on('error', function(error) {fs.writeFileSync('"+k+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+O+"');});}).on('error', function(error) {fs.writeFileSync('"+k+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+O+"');});"+(u?"req.write('"+JSON.stringify(u).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",j=s(process.argv[0],["-e",A]);r.existsSync(O););if(i.responseText=r.readFileSync(k,"utf8"),j.stdin.end(),r.unlinkSync(k),i.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var D=JSON.parse(i.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,""));i.handleError(D,503)}else{i.status=i.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");var U=JSON.parse(i.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"));o={statusCode:i.status,headers:U.data.headers},i.responseText=U.data.text,i.response=Buffer.from(U.data.data,"base64"),g(i.DONE,!0)}}}},this.handleError=function(e,t){this.status=t||0,this.statusText=e,this.responseText=e.stack,y=!0,g(this.DONE)},this.abort=function(){t&&(t.abort(),t=null),p=Object.assign({},d),this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),y=w=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!_||this.readyState===this.DONE||(_=!1,g(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(e,t){e in m||(m[e]=[]),m[e].push(t)},this.removeEventListener=function(e,t){e in m&&(m[e]=m[e].filter(function(e){return e!==t}))},this.dispatchEvent=function(e){if("function"===typeof i["on"+e]&&(this.readyState===this.DONE&&l.async?setImmediate(function(){i["on"+e]()}):i["on"+e]()),e in m)for(let t=0,r=m[e].length;t<r;t++)this.readyState===this.DONE?setImmediate(function(){m[e][t].call(i)}):m[e][t].call(i)};var g=function(e){if(!(i.readyState===e||i.readyState===i.UNSENT&&w)&&(i.readyState=e,(l.async||i.readyState<i.OPENED||i.readyState===i.DONE)&&i.dispatchEvent("readystatechange"),i.readyState===i.DONE)){let e;e=w?"abort":y?"error":"load",i.dispatchEvent(e),i.dispatchEvent("loadend")}}}t.exports=o,o.XMLHttpRequest=o}}),WebRError=class extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}},WebRWorkerError=class extends WebRError{},WebRChannelError=class extends WebRError{},IN_NODE="undefined"!==typeof process&&process.release&&"node"===process.release.name;if(globalThis.document)loadScript=e=>new Promise((t,r)=>{const n=document.createElement("script");n.src=e,n.onload=()=>t(),n.onerror=r,document.head.appendChild(n)});else if(globalThis.importScripts)loadScript=async e=>{try{globalThis.importScripts(e)}catch(t){if(!(t instanceof TypeError))throw t;await Promise.resolve().then(()=>__toESM(require(e)))}};else{if(!IN_NODE)throw new WebRError("Cannot determine runtime environment");loadScript=async e=>{const t=(await Promise.resolve().then(()=>__toESM(require("path")))).default;await Promise.resolve().then(()=>__toESM(require(t.resolve(e))))}}function promiseHandles(){const e={resolve:e=>{},reject:e=>{},promise:null},t=new Promise((t,r)=>{e.resolve=t,e.reject=r});return e.promise=t,e}function sleep(e){return new Promise(t=>setTimeout(t,e))}function replaceInObject(e,t,r,...n){return null===e||"object"!==typeof e?e:t(e)?r(e,...n):Array.isArray(e)||ArrayBuffer.isView(e)?e.map(e=>replaceInObject(e,t,r,...n)):Object.fromEntries(Object.entries(e).map(([e,s],o)=>[e,replaceInObject(s,t,r,...n)]))}function newCrossOriginWorker(e,t){const r=new XMLHttpRequest;r.open("get",e,!0),r.onload=()=>{const e=new Worker(URL.createObjectURL(new Blob([r.responseText])));t(e)},r.send()}function isCrossOrigin(e){if(IN_NODE)return!1;const t=new URL(location.href),r=new URL(e,location.origin);return t.host!==r.host||t.port!==r.port||t.protocol!==r.protocol}function throwUnreachable(e){let t="Reached the unreachable";throw t+=e?": "+e:".",new WebRError(t)}var SZ_BUF_DOESNT_FIT=0,SZ_BUF_FITS_IDX=1,SZ_BUF_SIZE_IDX=0,transferCache=new WeakMap;function transfer(e,t){return transferCache.set(e,t),e}function isUUID(e){return"string"===typeof e&&e.length===UUID_LENGTH}var UUID_LENGTH=63;function generateUUID(){const e=Array.from({length:4},randomSegment).join("-");if(e.length!==UUID_LENGTH)throw new Error("comlink internal error: UUID has the wrong length");return e}function randomSegment(){let e=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16);const t=15-e.length;return t>0&&(e=Array.from({length:t},()=>0).join("")+e),e}var _promises,_resolvers,_add,add_fn,import_msgpack=__toESM(require_dist()),encoder=new TextEncoder;async function syncResponse(e,t,r){try{let{taskId:n,sizeBuffer:s,dataBuffer:o,signalBuffer:i}=t;const a=(0,import_msgpack.encode)(r),c=a.length<=o.length;if(Atomics.store(s,SZ_BUF_SIZE_IDX,a.length),Atomics.store(s,SZ_BUF_FITS_IDX,+c),!c){const[t,r]=requestResponseMessage(e);o.set(encoder.encode(t)),await signalRequester(i,n),o=(await r).dataBuffer}o.set(a),Atomics.store(s,SZ_BUF_FITS_IDX,1),await signalRequester(i,n)}catch(n){console.warn(n)}}function requestResponseMessage(e){const t=generateUUID();return[t,new Promise(r=>{IN_NODE?e.once("message",e=>{e.id&&e.id===t&&r(e)}):e.addEventListener("message",function n(s){s.data&&s.data.id&&s.data.id===t&&(e.removeEventListener("message",n),r(s.data))}),e.start&&e.start()})]}async function signalRequester(e,t){const r=(t>>1)%32;let n=1;for(;0!==Atomics.compareExchange(e,r+1,0,t);)await sleep(n),n<32&&(n*=2);Atomics.or(e,0,1<<r),Atomics.notify(e,0)}var _parked,AsyncQueue=class{constructor(){__privateAdd(this,_add),__privateAdd(this,_promises,void 0),__privateAdd(this,_resolvers,void 0),__privateSet(this,_resolvers,[]),__privateSet(this,_promises,[])}reset(){__privateSet(this,_resolvers,[]),__privateSet(this,_promises,[])}put(e){__privateGet(this,_resolvers).length||__privateMethod(this,_add,add_fn).call(this);__privateGet(this,_resolvers).shift()(e)}async get(){__privateGet(this,_promises).length||__privateMethod(this,_add,add_fn).call(this);return __privateGet(this,_promises).shift()}isEmpty(){return!__privateGet(this,_promises).length}isBlocked(){return!!__privateGet(this,_resolvers).length}get length(){return __privateGet(this,_promises).length-__privateGet(this,_resolvers).length}};function newRequest(e,t){return newRequestResponseMessage({type:"request",data:{uuid:generateUUID(),msg:e}},t)}function newResponse(e,t,r){return newRequestResponseMessage({type:"response",data:{uuid:e,resp:t}},r)}function newRequestResponseMessage(e,t){return t&&transfer(e,t),e}function newSyncRequest(e,t){return{type:"sync-request",data:{msg:e,reqData:t}}}function webRPayloadAsError(e){const t=new WebRWorkerError(e.obj.message);return"Error"!==e.obj.name&&(t.name=e.obj.name),t.stack=e.obj.stack,t}function isWebRPayload(e){return e&&"object"===typeof e&&"payloadType"in e&&"obj"in e}function isWebRPayloadPtr(e){return isWebRPayload(e)&&"ptr"===e.payloadType}_promises=new WeakMap,_resolvers=new WeakMap,_add=new WeakSet,add_fn=function(){__privateGet(this,_promises).push(new Promise(e=>{__privateGet(this,_resolvers).push(e)}))};var ChannelMain=class{constructor(){this.inputQueue=new AsyncQueue,this.outputQueue=new AsyncQueue,this.systemQueue=new AsyncQueue,__privateAdd(this,_parked,new Map)}async read(){return await this.outputQueue.get()}async flush(){const e=[];for(;!this.outputQueue.isEmpty();)e.push(await this.read());return e}async readSystem(){return await this.systemQueue.get()}write(e){this.inputQueue.put(e)}async request(e,t){const r=newRequest(e,t),{resolve:n,reject:s,promise:o}=promiseHandles();return __privateGet(this,_parked).set(r.data.uuid,{resolve:n,reject:s}),this.write(r),o}putClosedMessage(){this.outputQueue.put({type:"closed"})}resolveResponse(e){const t=e.data.uuid,r=__privateGet(this,_parked).get(t);if(r){const n=e.data.resp;__privateGet(this,_parked).delete(t),"err"===n.payloadType?r.reject(webRPayloadAsError(n)):r.resolve(n)}else console.warn("Can't find request.")}};_parked=new WeakMap;var _scheduled,_resolved,_result,_exception,_syncGen,import_msgpack2=__toESM(require_dist()),decoder=new TextDecoder("utf-8"),SyncTask=class{constructor(e,t,r=[]){__privateAdd(this,_scheduled,!1),__privateAdd(this,_resolved,void 0),__privateAdd(this,_result,void 0),__privateAdd(this,_exception,void 0),__privateAdd(this,_syncGen,void 0),this.syncifier=new _Syncifier,this.endpoint=e,this.msg=t,this.transfers=r,__privateSet(this,_resolved,!1)}scheduleSync(){if(!__privateGet(this,_scheduled))return __privateSet(this,_scheduled,!0),this.syncifier.scheduleTask(this),__privateSet(this,_syncGen,this.doSync()),__privateGet(this,_syncGen).next(),this}poll(){if(!__privateGet(this,_scheduled))throw new Error("Task not synchronously scheduled");const{done:e,value:t}=__privateGet(this,_syncGen).next();return!!e&&(__privateSet(this,_resolved,!0),__privateSet(this,_result,t),!0)}*doSync(){const{endpoint:e,msg:t,transfers:r}=this,n=new Int32Array(new SharedArrayBuffer(8)),s=this.signalBuffer,o=this.taskId;let i=acquireDataBuffer(UUID_LENGTH);const a=newSyncRequest(t,{sizeBuffer:n,dataBuffer:i,signalBuffer:s,taskId:o});if(e.postMessage(a,r),yield,Atomics.load(n,SZ_BUF_FITS_IDX)===SZ_BUF_DOESNT_FIT){const t=decoder.decode(i.slice(0,UUID_LENGTH));releaseDataBuffer(i);i=acquireDataBuffer(Atomics.load(n,SZ_BUF_SIZE_IDX)),e.postMessage({id:t,dataBuffer:i}),yield}const c=Atomics.load(n,SZ_BUF_SIZE_IDX);return(0,import_msgpack2.decode)(i.slice(0,c))}get result(){if(__privateGet(this,_exception))throw __privateGet(this,_exception);if(__privateGet(this,_resolved))return __privateGet(this,_result);throw new Error("Not ready.")}syncify(){return this.scheduleSync(),this.syncifier.syncifyTask(this),this.result}};_scheduled=new WeakMap,_resolved=new WeakMap,_result=new WeakMap,_exception=new WeakMap,_syncGen=new WeakMap;var _Syncifier=class{constructor(){this.nextTaskId=new Int32Array([1]),this.signalBuffer=new Int32Array(new SharedArrayBuffer(132)),this.tasks=new Map}scheduleTask(e){e.taskId=this.nextTaskId[0],this.nextTaskId[0]+=2,e.signalBuffer=this.signalBuffer,this.tasks.set(e.taskId,e)}waitOnSignalBuffer(){for(;;){switch(Atomics.wait(this.signalBuffer,0,0,50)){case"ok":case"not-equal":return;case"timed-out":0!==interruptBuffer[0]&&handleInterrupt();break;default:throw new Error("Unreachable")}}}*tasksIdsToWakeup(){const e=Atomics.load(this.signalBuffer,0);for(let t=0;t<32;t++){const r=1<<t;if(e&r){Atomics.and(this.signalBuffer,0,~r);const e=Atomics.exchange(this.signalBuffer,t+1,0);yield e}}}pollTasks(e){let t=!1;for(const r of this.tasksIdsToWakeup()){const n=this.tasks.get(r);if(!n)throw new Error(`Assertion error: unknown taskId ${r}.`);n.poll()&&(this.tasks.delete(r),n===e&&(t=!0))}return t}syncifyTask(e){for(;;)if(this.waitOnSignalBuffer(),this.pollTasks(e))return}},dataBuffers=[];function acquireDataBuffer(e){const t=Math.ceil(Math.log2(e));dataBuffers[t]||(dataBuffers[t]=[]);const r=dataBuffers[t].pop();return r?(r.fill(0),r):new Uint8Array(new SharedArrayBuffer(2**t))}function releaseDataBuffer(e){const t=Math.ceil(Math.log2(e.byteLength));dataBuffers[t].push(e)}var interruptBuffer=new Int32Array(new ArrayBuffer(4)),handleInterrupt=()=>{throw interruptBuffer[0]=0,new Error("Interrupted!")};function setInterruptHandler(e){handleInterrupt=e}function setInterruptBuffer(e){interruptBuffer=new Int32Array(e)}var _interruptBuffer,_handleEventsFromWorker,handleEventsFromWorker_fn,_onMessageFromWorker,Module={};function dictEmFree(e){Object.keys(e).forEach(t=>Module._free(e[t]))}IN_NODE&&(globalThis.Worker=require("worker_threads").Worker);var _ep,_dispatch,_interruptBuffer2,_interrupt,SharedBufferChannelMain=class extends ChannelMain{constructor(e){super(),__privateAdd(this,_handleEventsFromWorker),__privateAdd(this,_interruptBuffer,void 0),this.close=()=>{},__privateAdd(this,_onMessageFromWorker,async(e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return __privateSet(this,_interruptBuffer,new Int32Array(t.data)),void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"sync-request":{const r=t,n=r.data.msg,s=r.data.reqData;switch(n.type){case"read":{const t=await this.inputQueue.get();await syncResponse(e,s,t);break}default:throw new WebRChannelError(`Unsupported request type '${n.type}'.`)}return}case"request":throw new WebRChannelError("Can't send messages of type 'request' from a worker. Please Use 'sync-request' instead.")}});const t=t=>{__privateMethod(this,_handleEventsFromWorker,handleEventsFromWorker_fn).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()};const r={type:"init",data:{config:e,channelType:ChannelType.SharedArrayBuffer}};t.postMessage(r)};if(isCrossOrigin(e.baseUrl))newCrossOriginWorker(`${e.baseUrl}webr-worker.js`,e=>t(e));else{const r=new Worker(`${e.baseUrl}webr-worker.js`);t(r)}({resolve:this.resolve,promise:this.initialised}=promiseHandles())}interrupt(){if(!__privateGet(this,_interruptBuffer))throw new WebRChannelError("Failed attempt to interrupt before initialising interruptBuffer");this.inputQueue.reset(),__privateGet(this,_interruptBuffer)[0]=1}};_interruptBuffer=new WeakMap,_handleEventsFromWorker=new WeakSet,handleEventsFromWorker_fn=function(e){IN_NODE?e.on("message",t=>{__privateGet(this,_onMessageFromWorker).call(this,e,t)}):e.onmessage=t=>__privateGet(this,_onMessageFromWorker).call(this,e,t.data)},_onMessageFromWorker=new WeakMap;var SharedBufferChannelWorker=class{constructor(){__privateAdd(this,_ep,void 0),__privateAdd(this,_dispatch,()=>0),__privateAdd(this,_interruptBuffer2,new Int32Array(new SharedArrayBuffer(4))),__privateAdd(this,_interrupt,()=>{}),__privateSet(this,_ep,IN_NODE?require("worker_threads").parentPort:globalThis),setInterruptBuffer(__privateGet(this,_interruptBuffer2).buffer),setInterruptHandler(()=>this.handleInterrupt())}resolve(){this.write({type:"resolve",data:__privateGet(this,_interruptBuffer2).buffer})}write(e,t){__privateGet(this,_ep).postMessage(e,t)}writeSystem(e,t){__privateGet(this,_ep).postMessage({type:"system",data:e},t)}read(){return new SyncTask(__privateGet(this,_ep),{type:"read"}).syncify()}inputOrDispatch(){for(;;){const e=this.read();if("stdin"===e.type)return Module.allocateUTF8(e.data);__privateGet(this,_dispatch).call(this,e)}}run(e){Module.callMain(e)}setInterrupt(e){__privateSet(this,_interrupt,e)}handleInterrupt(){0!==__privateGet(this,_interruptBuffer2)[0]&&(__privateGet(this,_interruptBuffer2)[0]=0,__privateGet(this,_interrupt).call(this))}setDispatchHandler(e){__privateSet(this,_dispatch,e)}};_ep=new WeakMap,_dispatch=new WeakMap,_interruptBuffer2=new WeakMap,_interrupt=new WeakMap;var _syncMessageCache,_registration,_interrupted,_registerServiceWorker,registerServiceWorker_fn,_onMessageFromServiceWorker,onMessageFromServiceWorker_fn,_handleEventsFromWorker2,handleEventsFromWorker_fn2,_onMessageFromWorker2,import_msgpack3=__toESM(require_dist());IN_NODE&&(globalThis.Worker=require("worker_threads").Worker);var _ep2,_mainThreadId,_location,_lastInterruptReq,_dispatch2,_interrupt2,ServiceWorkerChannelMain=class extends ChannelMain{constructor(e){super(),__privateAdd(this,_registerServiceWorker),__privateAdd(this,_onMessageFromServiceWorker),__privateAdd(this,_handleEventsFromWorker2),this.close=()=>{},__privateAdd(this,_syncMessageCache,new Map),__privateAdd(this,_registration,void 0),__privateAdd(this,_interrupted,!1),__privateAdd(this,_onMessageFromWorker2,async(e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"sync-request":{const e=t.data;return void __privateGet(this,_syncMessageCache).set(e.data.uuid,e.data.msg)}case"request":throw new WebRChannelError("Can't send messages of type 'request' from a worker.Use service worker fetch request instead.")}});const t=t=>{__privateMethod(this,_handleEventsFromWorker2,handleEventsFromWorker_fn2).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()},__privateMethod(this,_registerServiceWorker,registerServiceWorker_fn).call(this,`${e.serviceWorkerUrl}webr-serviceworker.js`).then(r=>{const n={type:"init",data:{config:e,channelType:ChannelType.ServiceWorker,clientId:r,location:window.location.href}};t.postMessage(n)})};if(isCrossOrigin(e.serviceWorkerUrl))newCrossOriginWorker(`${e.serviceWorkerUrl}webr-worker.js`,e=>t(e));else{const r=new Worker(`${e.serviceWorkerUrl}webr-worker.js`);t(r)}({resolve:this.resolve,promise:this.initialised}=promiseHandles())}activeRegistration(){var e;if(!(null==(e=__privateGet(this,_registration))?void 0:e.active))throw new WebRChannelError("Attempted to obtain a non-existent active registration.");return __privateGet(this,_registration).active}interrupt(){__privateSet(this,_interrupted,!0)}};_syncMessageCache=new WeakMap,_registration=new WeakMap,_interrupted=new WeakMap,_registerServiceWorker=new WeakSet,registerServiceWorker_fn=async function(e){__privateSet(this,_registration,await navigator.serviceWorker.register(e)),await navigator.serviceWorker.ready,window.addEventListener("beforeunload",()=>{var e;null==(e=__privateGet(this,_registration))||e.unregister()});const t=await new Promise(e=>{navigator.serviceWorker.addEventListener("message",function t(r){"registration-successful"===r.data.type&&(navigator.serviceWorker.removeEventListener("message",t),e(r.data.clientId))}),this.activeRegistration().postMessage({type:"register-client-main"})});return navigator.serviceWorker.addEventListener("message",e=>{__privateMethod(this,_onMessageFromServiceWorker,onMessageFromServiceWorker_fn).call(this,e)}),t},_onMessageFromServiceWorker=new WeakSet,onMessageFromServiceWorker_fn=async function(e){if("request"===e.data.type){const t=e.data.data,r=__privateGet(this,_syncMessageCache).get(t);if(!r)throw new WebRChannelError("Request not found during service worker XHR request");switch(__privateGet(this,_syncMessageCache).delete(t),r.type){case"read":{const e=await this.inputQueue.get();this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:newResponse(t,e)});break}case"interrupt":{const e=__privateGet(this,_interrupted);this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:newResponse(t,e)}),this.inputQueue.reset(),__privateSet(this,_interrupted,!1);break}default:throw new WebRChannelError(`Unsupported request type '${r.type}'.`)}return}},_handleEventsFromWorker2=new WeakSet,handleEventsFromWorker_fn2=function(e){IN_NODE?e.on("message",t=>{__privateGet(this,_onMessageFromWorker2).call(this,e,t)}):e.onmessage=t=>__privateGet(this,_onMessageFromWorker2).call(this,e,t.data)},_onMessageFromWorker2=new WeakMap;var ServiceWorkerChannelWorker=class{constructor(e){if(__privateAdd(this,_ep2,void 0),__privateAdd(this,_mainThreadId,void 0),__privateAdd(this,_location,void 0),__privateAdd(this,_lastInterruptReq,Date.now()),__privateAdd(this,_dispatch2,()=>0),__privateAdd(this,_interrupt2,()=>{}),this.onMessageFromMainThread=()=>{},!e.clientId||!e.location)throw new WebRChannelError("Can't start service worker channel");__privateSet(this,_mainThreadId,e.clientId),__privateSet(this,_location,e.location),__privateSet(this,_ep2,IN_NODE?require("worker_threads").parentPort:globalThis)}resolve(){this.write({type:"resolve"})}write(e,t){__privateGet(this,_ep2).postMessage(e,t)}writeSystem(e,t){__privateGet(this,_ep2).postMessage({type:"system",data:e},t)}syncRequest(e){const t=newRequest(e);this.write({type:"sync-request",data:t});let r=0;for(;;)try{const e=new URL("__wasm__/webr-fetch-request/",__privateGet(this,_location)),r=new XMLHttpRequest;r.timeout=6e4,r.responseType="arraybuffer",r.open("POST",e,!1);const n={clientId:__privateGet(this,_mainThreadId),uuid:t.data.uuid};return r.send((0,import_msgpack3.encode)(n)),(0,import_msgpack3.decode)(r.response)}catch(n){if(!(n instanceof DOMException&&r++<1e3))throw n;console.log("Service worker request failed - resending request")}}read(){return this.syncRequest({type:"read"}).data.resp}inputOrDispatch(){for(;;){const e=this.read();if("stdin"===e.type)return Module.allocateUTF8(e.data);__privateGet(this,_dispatch2).call(this,e)}}run(e){Module.callMain(e)}setInterrupt(e){__privateSet(this,_interrupt2,e)}handleInterrupt(){if(Date.now()>__privateGet(this,_lastInterruptReq)+1e3){__privateSet(this,_lastInterruptReq,Date.now());this.syncRequest({type:"interrupt"}).data.resp&&__privateGet(this,_interrupt2).call(this)}}setDispatchHandler(e){__privateSet(this,_dispatch2,e)}};_ep2=new WeakMap,_mainThreadId=new WeakMap,_location=new WeakMap,_lastInterruptReq=new WeakMap,_dispatch2=new WeakMap,_interrupt2=new WeakMap;var ChannelType={Automatic:0,SharedArrayBuffer:1,ServiceWorker:2};function newChannelWorker(e){switch(e.data.channelType){case ChannelType.SharedArrayBuffer:return new SharedBufferChannelWorker;case ChannelType.ServiceWorker:return new ServiceWorkerChannelWorker(e.data);default:throw new WebRChannelError("Unknown worker channel type recieved")}}var RTypeMap={null:0,symbol:1,pairlist:2,closure:3,environment:4,promise:5,call:6,special:7,builtin:8,string:9,logical:10,integer:13,double:14,complex:15,character:16,dots:17,any:18,list:19,expression:20,bytecode:21,pointer:22,weakref:23,raw:24,s4:25,new:30,free:31,function:99};function isWebRDataJs(e){return e&&"object"===typeof e&&Object.keys(RTypeMap).includes(e.type)}function isComplex(e){return e&&"object"===typeof e&&"re"in e&&"im"in e}function protect(e){return Module._Rf_protect(handlePtr(e)),e}function protectInc(e,t){return Module._Rf_protect(handlePtr(e)),++t.n,e}function protectWithIndex(e){const t=Module._malloc(4);Module._R_ProtectWithIndex(handlePtr(e),t);return{loc:Module.getValue(t,"i32"),ptr:t}}function unprotectIndex(e){Module._Rf_unprotect(1),Module._free(e.ptr)}function reprotect(e,t){return Module._R_Reprotect(handlePtr(e),t.loc),e}function unprotect(e){Module._Rf_unprotect(e)}function envPoke(e,t,r){Module._Rf_defineVar(handlePtr(t),handlePtr(r),handlePtr(e))}function parseEvalBare(e,t){const r={},n={n:0};try{const s=new REnvironment(t);protectInc(s,n),r.code=Module.allocateUTF8(e);const o=Module._R_ParseEvalString(r.code,s.ptr);return RObject.wrap(o)}finally{dictEmFree(r),unprotect(n.n)}}var UnwindProtectException=class extends Error{constructor(e,t){super(e),this.name="UnwindProtectException",this.cont=t}};function safeEval(e,t){return Module.getWasmTableEntry(Module.GOT.ffi_safe_eval.value)(handlePtr(e),handlePtr(t))}function handlePtr(e){return isRObject(e)?e.ptr:e}function assertRType(e,t){if(Module._TYPEOF(e.ptr)!==RTypeMap[t])throw new Error(`Unexpected object type "${e.type()}" when expecting type "${t}"`)}var shelters=new Map;function keep(e,t){const r=handlePtr(t);if(Module._R_PreserveObject(r),void 0!==e){if(!isUUID(e))throw new Error("Unexpected shelter type "+typeof e);shelters.get(e).push(r)}}function destroy(e,t){const r=handlePtr(t);Module._R_ReleaseObject(r);const n=shelters.get(e),s=n.indexOf(r);if(s<0)throw new Error("Can't find object in shelter.");n.splice(s,1)}function purge(e){const t=shelters.get(e);for(const n of t)try{Module._R_ReleaseObject(n)}catch(r){console.error(r)}shelters.set(e,[])}function newObjectFromData(e){if(isWebRDataJs(e))return new(getRWorkerClass(RTypeMap[e.type]))(e);if(e&&"object"===typeof e&&"type"in e&&"null"===e.type)return new RNull;if(null===e)return new RLogical({type:"logical",names:null,values:[null]});if("boolean"===typeof e)return new RLogical(e);if("number"===typeof e)return new RDouble(e);if("string"===typeof e)return new RCharacter(e);if(isComplex(e))return new RComplex(e);if(Array.isArray(e))return newObjectFromArray(e);throw new Error("Robj construction for this JS object is not yet supported")}function newObjectFromArray(e){const t={n:0};try{const r=new RCall([new RSymbol("c"),...e]);return protectInc(r,t),r.eval()}finally{unprotect(t.n)}}var _slice,slice_fn,RObjectBase=class{constructor(e){this.ptr=e}type(){const e=Module._TYPEOF(this.ptr);return Object.keys(RTypeMap).find(t=>RTypeMap[t]===e)}},_RObject=class extends RObjectBase{constructor(e){if(!(e instanceof RObjectBase))return newObjectFromData(e);super(e.ptr),__privateAdd(this,_slice)}static wrap(e){return new(getRWorkerClass(Module._TYPEOF(e)))(new RObjectBase(e))}get[Symbol.toStringTag](){return`RObject:${this.type()}`}static getPersistentObject(e){return objs[e]}getPropertyValue(e){return this[e]}inspect(){parseEvalBare(".Internal(inspect(x))",{x:this})}isNull(){return Module._TYPEOF(this.ptr)===RTypeMap.null}isUnbound(){return this.ptr===objs.unboundValue.ptr}attrs(){return RPairlist.wrap(Module._ATTRIB(this.ptr))}setNames(e){let t;if(null===e)t=objs.null;else{if(!Array.isArray(e)||!e.every(e=>"string"===typeof e||null===e))throw new Error("Argument to setNames must be null or an Array of strings or null");t=new RCharacter(e)}return Module._Rf_setAttrib(this.ptr,objs.namesSymbol.ptr,t.ptr),this}names(){const e=RCharacter.wrap(Module._Rf_getAttrib(this.ptr,objs.namesSymbol.ptr));return e.isNull()?null:e.toArray()}includes(e){const t=this.names();return t&&t.includes(e)}toJs(e={depth:0},t=1){throw new Error("This R object cannot be converted to JS")}subset(e){return __privateMethod(this,_slice,slice_fn).call(this,e,objs.bracketSymbol.ptr)}get(e){return __privateMethod(this,_slice,slice_fn).call(this,e,objs.bracket2Symbol.ptr)}getDollar(e){return __privateMethod(this,_slice,slice_fn).call(this,e,objs.dollarSymbol.ptr)}pluck(...e){const t=protectWithIndex(objs.null);try{const r=(e,r)=>reprotect(e.get(r),t),n=e.reduce(r,this);return n.isNull()?void 0:n}finally{unprotectIndex(t)}}set(e,t){const r={n:0};try{const n=new _RObject(e);protectInc(n,r);const s=new _RObject(t);protectInc(s,r);const o=new RSymbol("[[<-"),i=Module._Rf_lang4(o.ptr,this.ptr,n.ptr,s.ptr);return protectInc(i,r),_RObject.wrap(safeEval(i,objs.baseEnv))}finally{unprotect(r.n)}}static getMethods(e){const t=new Set;let r=e;do{Object.getOwnPropertyNames(r).map(e=>t.add(e))}while(r=Object.getPrototypeOf(r));return[...t.keys()].filter(t=>"function"===typeof e[t])}},RObject=_RObject;_slice=new WeakSet,slice_fn=function(e,t){const r={n:0};try{const n=new _RObject(e);protectInc(n,r);const s=Module._Rf_lang3(t,this.ptr,n.ptr);return protectInc(s,r),_RObject.wrap(safeEval(s,objs.baseEnv))}finally{unprotect(r.n)}};var _newSetter,_newSetter2,RNull=class extends RObject{constructor(){return super(new RObjectBase(Module.getValue(Module._R_NilValue,"*"))),this}toJs(){return{type:"null"}}},RSymbol=class extends RObject{constructor(e){if(e instanceof RObjectBase)return assertRType(e,"symbol"),void super(e);const t=Module.allocateUTF8(e);try{super(new RObjectBase(Module._Rf_install(t)))}finally{Module._free(t)}}toJs(){const e=this.toObject();return{type:"symbol",printname:e.printname,symvalue:e.symvalue,internal:e.internal}}toObject(){return{printname:this.printname().isUnbound()?null:this.printname().toString(),symvalue:this.symvalue().isUnbound()?null:this.symvalue().ptr,internal:this.internal().isNull()?null:this.internal().ptr}}toString(){return this.printname().toString()}printname(){return RString.wrap(Module._PRINTNAME(this.ptr))}symvalue(){return RObject.wrap(Module._SYMVALUE(this.ptr))}internal(){return RObject.wrap(Module._INTERNAL(this.ptr))}},RPairlist=class extends RObject{constructor(e){if(e instanceof RObjectBase)return assertRType(e,"pairlist"),super(e),this;const t={n:0};try{const{names:r,values:n}=toWebRData(e),s=RPairlist.wrap(Module._Rf_allocList(n.length));protectInc(s,t);for(let[e,t]=[0,s];!t.isNull();[e,t]=[e+1,t.cdr()])t.setcar(new RObject(n[e]));s.setNames(r),super(s)}finally{unprotect(t.n)}}get length(){return this.toArray().length}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=1}={}){const n=this.entries({depth:r}),s=n.map(([e,t])=>e);if(!e&&new Set(s).size!==s.length)throw new Error("Duplicate key when converting pairlist without allowDuplicateKey enabled");if(!t&&s.some(e=>!e))throw new Error("Empty or null key when converting pairlist without allowEmptyKey enabled");return Object.fromEntries(n.filter((e,t)=>n.findIndex(t=>t[0]===e[0])===t))}entries(e={depth:1}){const t=this.toJs(e);return t.values.map((e,r)=>[t.names?t.names[r]:null,e])}toJs(e={depth:0},t=1){const r=[];let n=!1;const s=[];for(let o=this;!o.isNull();o=o.cdr()){const i=o.tag();i.isNull()?r.push(""):(n=!0,r.push(i.toString())),e.depth&&t>=e.depth?s.push(o.car()):s.push(o.car().toJs(e,t+1))}return{type:"pairlist",names:n?r:null,values:s}}includes(e){return e in this.toObject()}setcar(e){Module._SETCAR(this.ptr,e.ptr)}car(){return RObject.wrap(Module._CAR(this.ptr))}cdr(){return RObject.wrap(Module._CDR(this.ptr))}tag(){return RObject.wrap(Module._TAG(this.ptr))}},RCall=class extends RObject{constructor(e){if(e instanceof RObjectBase)return assertRType(e,"call"),super(e),this;const t={n:0};try{const{values:r}=toWebRData(e),n=r.map(e=>protectInc(new RObject(e),t)),s=RCall.wrap(Module._Rf_allocVector(RTypeMap.call,r.length));protectInc(s,t);for(let[e,t]=[0,s];!t.isNull();[e,t]=[e+1,t.cdr()])t.setcar(n[e]);super(s)}finally{unprotect(t.n)}}setcar(e){Module._SETCAR(this.ptr,e.ptr)}car(){return RObject.wrap(Module._CAR(this.ptr))}cdr(){return RObject.wrap(Module._CDR(this.ptr))}eval(){return RObject.wrap(safeEval(this.ptr,objs.baseEnv))}},RList=class extends RObject{constructor(e){if(e instanceof RObjectBase)return assertRType(e,"list"),super(e),this;const t={n:0};try{const{names:r,values:n}=toWebRData(e),s=Module._Rf_allocVector(RTypeMap.list,n.length);protectInc(s,t),n.forEach((e,t)=>{Module._SET_VECTOR_ELT(s,t,new RObject(e).ptr)}),RObject.wrap(s).setNames(r),super(new RObjectBase(s))}finally{unprotect(t.n)}}get length(){return Module._LENGTH(this.ptr)}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=1}={}){const n=this.entries({depth:r}),s=n.map(([e,t])=>e);if(!e&&new Set(s).size!==s.length)throw new Error("Duplicate key when converting list without allowDuplicateKey enabled");if(!t&&s.some(e=>!e))throw new Error("Empty or null key when converting list without allowEmptyKey enabled");return Object.fromEntries(n.filter((e,t)=>n.findIndex(t=>t[0]===e[0])===t))}entries(e={depth:1}){const t=this.toJs(e);return t.values.map((e,r)=>[t.names?t.names[r]:null,e])}toJs(e={depth:0},t=1){return{type:"list",names:this.names(),values:[...Array(this.length).keys()].map(r=>e.depth&&t>=e.depth?this.get(r+1):this.get(r+1).toJs(e,t+1))}}},RFunction=class extends RObject{exec(...e){const t={n:0};try{const r=new RCall([this,...e]);return protectInc(r,t),r.eval()}finally{unprotect(t.n)}}},RString=class extends RObject{constructor(e){if(e instanceof RObjectBase)return assertRType(e,"string"),void super(e);const t=Module.allocateUTF8(e);try{super(new RObjectBase(Module._Rf_mkChar(t)))}finally{Module._free(t)}}toString(){return Module.UTF8ToString(Module._R_CHAR(this.ptr))}toJs(){return{type:"string",value:this.toString()}}},REnvironment=class extends RObject{constructor(e={}){if(e instanceof RObjectBase)return assertRType(e,"environment"),super(e),this;let t=0;try{const{names:r,values:n}=toWebRData(e),s=protect(Module._R_NewEnv(objs.globalEnv.ptr,0,0));++t,n.forEach((e,t)=>{const n=r?r[t]:null;if(!n)throw new Error("Can't create object in new environment with empty symbol name");const o=new RSymbol(n),i=protect(new RObject(e));try{envPoke(s,o,i)}finally{unprotect(1)}}),super(new RObjectBase(s))}finally{unprotect(t)}}ls(e=!1,t=!0){return RCharacter.wrap(Module._R_lsInternal3(this.ptr,Number(e),Number(t))).toArray()}bind(e,t){const r=new RSymbol(e),n=protect(new RObject(t));try{envPoke(this,r,n)}finally{unprotect(1)}}names(){return this.ls(!0,!0)}frame(){return RObject.wrap(Module._FRAME(this.ptr))}subset(e){if("number"===typeof e)throw new Error("Object of type environment is not subsettable");return this.getDollar(e)}toObject({depth:e=0}={}){const t=this.names();return Object.fromEntries([...Array(t.length).keys()].map(r=>[t[r],this.getDollar(t[r]).toJs({depth:e})]))}toJs(e={depth:0},t=1){const r=this.names(),n=[...Array(r.length).keys()].map(n=>e.depth&&t>=e.depth?this.getDollar(r[n]):this.getDollar(r[n]).toJs(e,t+1));return{type:"environment",names:r,values:n}}},RVectorAtomic=class extends RObject{constructor(e,t,r){if(e instanceof RObjectBase)return assertRType(e,t),super(e),this;const n={n:0};try{const{names:s,values:o}=toWebRData(e),i=Module._Rf_allocVector(RTypeMap[t],o.length);protectInc(i,n),o.forEach(r(i)),RObject.wrap(i).setNames(s),super(new RObjectBase(i))}finally{unprotect(n.n)}}get length(){return Module._LENGTH(this.ptr)}get(e){return super.get(e)}subset(e){return super.subset(e)}getDollar(e){throw new Error("$ operator is invalid for atomic vectors")}detectMissing(){const e={n:0};try{const t=Module._Rf_lang2(new RSymbol("is.na").ptr,this.ptr);protectInc(t,e);const r=RLogical.wrap(safeEval(t,objs.baseEnv));protectInc(r,e);const n=r.toTypedArray();return Array.from(n).map(e=>Boolean(e))}finally{unprotect(e.n)}}toArray(){const e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:e[r])}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1}={}){const r=this.entries(),n=r.map(([e,t])=>e);if(!e&&new Set(n).size!==n.length)throw new Error("Duplicate key when converting atomic vector without allowDuplicateKey enabled");if(!t&&n.some(e=>!e))throw new Error("Empty or null key when converting atomic vector without allowEmptyKey enabled");return Object.fromEntries(r.filter((e,t)=>r.findIndex(t=>t[0]===e[0])===t))}entries(){const e=this.toArray(),t=this.names();return e.map((e,r)=>[t?t[r]:null,e])}toJs(){return{type:this.type(),names:this.names(),values:this.toArray()}}},_RLogical=class extends RVectorAtomic{constructor(e){super(e,"logical",__privateGet(_RLogical,_newSetter))}getBoolean(e){return this.get(e).toArray()[0]}toBoolean(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");const e=this.getBoolean(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS boolean");return e}toTypedArray(){return new Int32Array(Module.HEAP32.subarray(Module._LOGICAL(this.ptr)/4,Module._LOGICAL(this.ptr)/4+this.length))}toArray(){const e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:Boolean(e[r]))}},RLogical=_RLogical;_newSetter=new WeakMap,__privateAdd(RLogical,_newSetter,e=>{const t=Module._LOGICAL(e),r=Module.getValue(Module._R_NaInt,"i32");return(e,n)=>{Module.setValue(t+4*n,null===e?r:Boolean(e),"i32")}});var _newSetter3,_RInteger=class extends RVectorAtomic{constructor(e){super(e,"integer",__privateGet(_RInteger,_newSetter2))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");const e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Int32Array(Module.HEAP32.subarray(Module._INTEGER(this.ptr)/4,Module._INTEGER(this.ptr)/4+this.length))}},RInteger=_RInteger;_newSetter2=new WeakMap,__privateAdd(RInteger,_newSetter2,e=>{const t=Module._INTEGER(e),r=Module.getValue(Module._R_NaInt,"i32");return(e,n)=>{Module.setValue(t+4*n,null===e?r:Math.round(Number(e)),"i32")}});var _newSetter4,_RDouble=class extends RVectorAtomic{constructor(e){super(e,"double",__privateGet(_RDouble,_newSetter3))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");const e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Float64Array(Module.HEAPF64.subarray(Module._REAL(this.ptr)/8,Module._REAL(this.ptr)/8+this.length))}},RDouble=_RDouble;_newSetter3=new WeakMap,__privateAdd(RDouble,_newSetter3,e=>{const t=Module._REAL(e),r=Module.getValue(Module._R_NaReal,"double");return(e,n)=>{Module.setValue(t+8*n,null===e?r:e,"double")}});var _newSetter5,_RComplex=class extends RVectorAtomic{constructor(e){super(e,"complex",__privateGet(_RComplex,_newSetter4))}getComplex(e){return this.get(e).toArray()[0]}toComplex(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");const e=this.getComplex(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS object");return e}toTypedArray(){return new Float64Array(Module.HEAPF64.subarray(Module._COMPLEX(this.ptr)/8,Module._COMPLEX(this.ptr)/8+2*this.length))}toArray(){const e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:{re:e[2*r],im:e[2*r+1]})}},RComplex=_RComplex;_newSetter4=new WeakMap,__privateAdd(RComplex,_newSetter4,e=>{const t=Module._COMPLEX(e),r=Module.getValue(Module._R_NaReal,"double");return(e,n)=>{Module.setValue(t+2*n*8,null===e?r:e.re,"double"),Module.setValue(t+8*(2*n+1),null===e?r:e.im,"double")}});var _newSetter6,_RCharacter=class extends RVectorAtomic{constructor(e){super(e,"character",__privateGet(_RCharacter,_newSetter5))}getString(e){return this.get(e).toArray()[0]}toString(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");const e=this.getString(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS string");return e}toTypedArray(){return new Uint32Array(Module.HEAPU32.subarray(Module._STRING_PTR(this.ptr)/4,Module._STRING_PTR(this.ptr)/4+this.length))}toArray(){return this.detectMissing().map((e,t)=>e?null:Module.UTF8ToString(Module._R_CHAR(Module._STRING_ELT(this.ptr,t))))}},RCharacter=_RCharacter;_newSetter5=new WeakMap,__privateAdd(RCharacter,_newSetter5,e=>(t,r)=>{null===t?Module._SET_STRING_ELT(e,r,objs.naString.ptr):Module._SET_STRING_ELT(e,r,new RString(t).ptr)});var objs,_RRaw=class extends RVectorAtomic{constructor(e){super(e,"raw",__privateGet(_RRaw,_newSetter6))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");const e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Uint8Array(Module.HEAPU8.subarray(Module._RAW(this.ptr),Module._RAW(this.ptr)+this.length))}},RRaw=_RRaw;function toWebRData(e){return isWebRDataJs(e)?e:Array.isArray(e)||ArrayBuffer.isView(e)?{names:null,values:e}:e&&"object"===typeof e&&!isComplex(e)?{names:Object.keys(e),values:Object.values(e)}:{names:null,values:[e]}}function getRWorkerClass(e){const t={[RTypeMap.null]:RNull,[RTypeMap.symbol]:RSymbol,[RTypeMap.pairlist]:RPairlist,[RTypeMap.closure]:RFunction,[RTypeMap.environment]:REnvironment,[RTypeMap.call]:RCall,[RTypeMap.special]:RFunction,[RTypeMap.builtin]:RFunction,[RTypeMap.string]:RString,[RTypeMap.logical]:RLogical,[RTypeMap.integer]:RInteger,[RTypeMap.double]:RDouble,[RTypeMap.complex]:RComplex,[RTypeMap.character]:RCharacter,[RTypeMap.list]:RList,[RTypeMap.raw]:RRaw,[RTypeMap.function]:RFunction};return e in t?t[e]:RObject}function isRObject(e){return e instanceof RObject}function initPersistentObjects(){objs={baseEnv:REnvironment.wrap(Module.getValue(Module._R_BaseEnv,"*")),bracket2Symbol:RSymbol.wrap(Module.getValue(Module._R_Bracket2Symbol,"*")),bracketSymbol:RSymbol.wrap(Module.getValue(Module._R_BracketSymbol,"*")),dollarSymbol:RSymbol.wrap(Module.getValue(Module._R_DollarSymbol,"*")),emptyEnv:REnvironment.wrap(Module.getValue(Module._R_EmptyEnv,"*")),false:RLogical.wrap(Module.getValue(Module._R_FalseValue,"*")),globalEnv:REnvironment.wrap(Module.getValue(Module._R_GlobalEnv,"*")),na:RLogical.wrap(Module.getValue(Module._R_LogicalNAValue,"*")),namesSymbol:RSymbol.wrap(Module.getValue(Module._R_NamesSymbol,"*")),naString:RObject.wrap(Module.getValue(Module._R_NaString,"*")),null:RNull.wrap(Module.getValue(Module._R_NilValue,"*")),true:RLogical.wrap(Module.getValue(Module._R_TrueValue,"*")),unboundValue:RObject.wrap(Module.getValue(Module._R_UnboundValue,"*"))}}_newSetter6=new WeakMap,__privateAdd(RRaw,_newSetter6,e=>{const t=Module._RAW(e);return(e,r)=>{Module.setValue(t+r,Number(e),"i8")}});var chan,_config,initialised=!1,onWorkerMessage=function(e){if(!e||!e.type||"init"!==e.type)return;if(initialised)throw new Error("Can't initialise worker multiple times.");const t=e;chan=newChannelWorker(t),init(t.data.config),initialised=!0};function dispatch(e){switch(e.type){case"request":{const r=e,n=r.data.msg,s=(e,t)=>null==chan?void 0:chan.write(newResponse(r.data.uuid,e,t));try{switch(n.type){case"lookupPath":{const e=n;s({obj:copyFSNode(Module.FS.lookupPath(e.data.path,{}).node),payloadType:"raw"});break}case"mkdir":{const e=n;s({obj:copyFSNode(Module.FS.mkdir(e.data.path)),payloadType:"raw"});break}case"readFile":{const e=n.data,t={obj:Module.FS.readFile(e.path,{encoding:"binary",flags:e.flags}),payloadType:"raw"};s(t,[t.obj.buffer]);break}case"rmdir":{const e=n;s({obj:Module.FS.rmdir(e.data.path),payloadType:"raw"});break}case"writeFile":{const e=n.data,t=Uint8Array.from(Object.values(e.data));s({obj:Module.FS.writeFile(e.path,t,{flags:e.flags}),payloadType:"raw"});break}case"unlink":{const e=n;s({obj:Module.FS.unlink(e.data.path),payloadType:"raw"});break}case"newShelter":{const e=generateUUID();shelters.set(e,[]),s({payloadType:"raw",obj:e});break}case"shelterSize":{const e=n;s({payloadType:"raw",obj:shelters.get(e.data).length});break}case"shelterPurge":purge(n.data),s({payloadType:"raw",obj:null});break;case"shelterDestroy":{const e=n;destroy(e.data.id,e.data.obj.obj.ptr),s({payloadType:"raw",obj:null});break}case"captureR":{const e=n.data,t=e.shelter,r={n:0};try{const n=captureR(e.code,e.options);protectInc(n,r);const o=n.get("result"),i=n.get(2);keep(t,o);const a=i.length,c=[];for(let e=1;e<a+1;++e){const r=i.get(e),n=r.pluck(1,1).toString(),s=r.get(2);if("stdout"===n||"stderr"===n){const e=s.toString();c.push({type:n,data:e})}else{keep(t,s);const e={obj:{ptr:s.ptr,type:s.type(),methods:RObject.getMethods(s)},payloadType:"ptr"};c.push({type:n,data:e})}}s({payloadType:"raw",obj:{result:{payloadType:"ptr",obj:{ptr:o.ptr,type:o.type(),methods:RObject.getMethods(o)}},output:c}})}finally{unprotect(r.n)}break}case"evalR":{const e=n,t=evalR(e.data.code,e.data.options);keep(e.data.shelter,t),s({obj:{type:t.type(),ptr:t.ptr,methods:RObject.getMethods(t)},payloadType:"ptr"});break}case"evalRRaw":{const e=n,t=evalR(e.data.code,e.data.options);protect(t);const r=()=>{throw new Error(`Can't convert object of type ${t.type()} to ${e.data.outputType}.`)};try{let n;switch(e.data.outputType){case"void":break;case"boolean":if("logical"===t.type())n=t.toBoolean();else r();break;case"boolean[]":if("logical"===t.type())n=t.toArray(),n.some(e=>null===e)&&r();else r();break;case"number":switch(t.type()){case"logical":n=t.toBoolean(),n=Number(n);break;case"integer":case"double":n=t.toNumber();break;default:r()}break;case"number[]":switch(t.type()){case"logical":n=t.toArray(),n=n.map(e=>null===e?r():Number(e));break;case"integer":case"double":n=t.toArray(),n.some(e=>null===e)&&r();break;default:r()}break;case"string":if("character"===t.type())n=t.toString();else r();break;case"string[]":if("character"===t.type())n=t.toArray(),n.some(e=>null===e)&&r();else r();break;default:throw new Error("Unexpected output type in `evalRRaw().")}s({obj:n,payloadType:"raw"});break}finally{unprotect(1)}}case"newRObject":{const e=n,t=newRObject(e.data.obj,e.data.objType);keep(e.data.shelter,t.obj.ptr),s(t);break}case"callRObjectMethod":{const e=n.data,t=callRObjectMethod(e.payload?RObject.wrap(e.payload.obj.ptr):RObject,e.prop,e.args);isWebRPayloadPtr(t)&&keep(e.shelter,t.obj.ptr),s(t);break}case"invokeWasmFunction":{const e=n;s({payloadType:"raw",obj:Module.getWasmTableEntry(e.data.ptr)(...e.data.args)});break}case"installPackage":evalR(`webr::install(\n              "${n.data.name}",\n              repos = "${_config.repoUrl}",\n              quiet = ${n.data.quiet?"TRUE":"FALSE"}\n            )`),s({obj:!0,payloadType:"raw"});break;default:throw new Error("Unknown event `"+n.type+"`")}}catch(t){const e=t;s({payloadType:"err",obj:{name:e.name,message:e.message,stack:e.stack}}),e instanceof UnwindProtectException&&(Module._R_ContinueUnwind(e.cont),throwUnreachable())}break}default:throw new Error("Unknown event `"+e.type+"`")}}function copyFSNode(e){const t={id:e.id,name:e.name,mode:e.mode,isFolder:e.isFolder,contents:{}};return e.isFolder&&(t.contents=Object.entries(e.contents).map(([,e])=>copyFSNode(e))),t}function downloadFileContent(e,t=[]){const r=new XMLHttpRequest;r.open("GET",e,!1),r.responseType="arraybuffer";try{t.forEach(e=>{const t=e.split(": ");r.setRequestHeader(t[0],t[1])})}catch{const e="An error occured setting headers in XMLHttpRequest";return console.error(e),{status:400,response:e}}try{r.send(null);const t=IN_NODE?JSON.parse(String(r.status)).data.statusCode:r.status;if(t>=200&&t<300)return{status:t,response:r.response};{const n=(new TextDecoder).decode(r.response);return console.error(`Error fetching ${e} - ${n}`),{status:t,response:n}}}catch{return{status:400,response:"An error occured in XMLHttpRequest"}}}function newRObject(e,t){const r=new("object"===t?RObject:getRWorkerClass(RTypeMap[t]))(replaceInObject(e,isWebRPayloadPtr,e=>RObject.wrap(e.obj.ptr)));return{obj:{type:r.type(),ptr:r.ptr,methods:RObject.getMethods(r)},payloadType:"ptr"}}function callRObjectMethod(e,t,r){if(!(t in e))throw new ReferenceError(`${t} is not defined`);const n=e[t];if("function"!==typeof n)throw Error("Requested property cannot be invoked");const s=n.apply(e,r.map(e=>"ptr"===e.payloadType?RObject.wrap(e.obj.ptr):replaceInObject(e.obj,isWebRPayloadPtr,e=>RObject.wrap(e.obj.ptr))));return{obj:replaceInObject(s,isRObject,e=>({obj:{type:e.type(),ptr:e.ptr,methods:RObject.getMethods(e)},payloadType:"ptr"})),payloadType:"raw"}}function captureR(e,t={}){var r;const n={n:0};try{const s=Object.assign({env:objs.globalEnv,captureStreams:!0,captureConditions:!0,withAutoprint:!1,throwJsException:!0,withHandlers:!0},replaceInObject(t,isWebRPayloadPtr,e=>RObject.wrap(e.obj.ptr))),o=new REnvironment(s.env);if(protectInc(o,n),"environment"!==o.type())throw new Error("Attempted to evaluate R code with invalid environment object");const i=objs.true.ptr,a=objs.false.ptr,c=parseEvalBare("webr::eval_r",objs.baseEnv);protectInc(c,n);const l=new RCharacter(e);protectInc(l,n);const u=Module._Rf_lang6(c.ptr,l.ptr,s.captureConditions?i:a,s.captureStreams?i:a,s.withAutoprint?i:a,s.withHandlers?i:a);protectInc(u,n);const d=RList.wrap(safeEval(u,o));if(protectInc(d,n),s.captureConditions&&s.throwJsException){const e=d.get("output").toArray().find(e=>"error"===e.get("type").toString());if(e)throw new Error((null==(r=e.pluck("data","message"))?void 0:r.toString())||"An error occured evaluating R code.")}return d}finally{unprotect(n.n)}}function evalR(e,t={}){var r,n;const s=captureR(e,t);Module._Rf_protect(s.ptr);try{const e=s.get("output");for(let t=1;t<=e.length;t++){const s=e.get(t),o=s.get("type").toString();switch(o){case"stdout":null==chan||chan.writeSystem({type:"console.log",data:s.get("data").toString()});break;case"stderr":null==chan||chan.writeSystem({type:"console.warn",data:s.get("data").toString()});break;case"message":null==chan||chan.writeSystem({type:"console.warn",data:(null==(r=s.pluck("data","message"))?void 0:r.toString())||""});break;case"warning":null==chan||chan.writeSystem({type:"console.warn",data:`Warning message: \n${(null==(n=s.pluck("data","message"))?void 0:n.toString())||""}`});break;default:null==chan||chan.writeSystem({type:"console.warn",data:`Output of type ${o}:`}),null==chan||chan.writeSystem({type:"console.warn",data:s.get("data").toJs()})}}return s.get("result")}finally{Module._Rf_unprotect(1)}}function init(e){_config=e;const t={...e.REnv};if(!t.TZ){const e=new Intl.DateTimeFormat;t.TZ=e.resolvedOptions().timeZone}Module.preRun=[],Module.arguments=_config.RArgs,Module.noExitRuntime=!0,Module.noImageDecoding=!0,Module.noAudioDecoding=!0,Module.noInitialRun=!0,Module.noWasmDecoding=!0,Module.preRun.push(()=>{IN_NODE&&(globalThis.FS=Module.FS),_config.createLazyFilesystem&&Module.createLazyFilesystem(),Module.FS.mkdirTree(_config.homedir),Module.ENV.HOME=_config.homedir,Module.FS.chdir(_config.homedir),Module.ENV=Object.assign(Module.ENV,t)}),null==chan||chan.setDispatchHandler(dispatch),Module.onRuntimeInitialized=()=>{null==chan||chan.run(_config.RArgs)},Module.webr={UnwindProtectException:UnwindProtectException,resolveInit:()=>{initPersistentObjects(),null==chan||chan.setInterrupt(Module._Rf_onintr),Module.setValue(Module._R_Interactive,_config.interactive,"*"),evalR(`options(webr_pkg_repos="${_config.repoUrl}")`),null==chan||chan.resolve()},readConsole:()=>{if(!chan)throw new Error("Can't read console input without a communication channel");return chan.inputOrDispatch()},handleEvents:()=>{null==chan||chan.handleInterrupt()},evalJs:e=>{try{return(0,eval)(Module.UTF8ToString(e))}catch(t){if(t instanceof UnwindProtectException)Module._R_ContinueUnwind(t.cont),throwUnreachable();else if(t===1/0)throw t;const e=Module.allocateUTF8OnStack(`An error occured during JavaScript evaluation:\n  ${t.message}`);Module._Rf_error(e)}return throwUnreachable(),0},setTimeoutWasm:(e,t,...r)=>{null==chan||chan.writeSystem({type:"setTimeoutWasm",data:{ptr:e,delay:t,args:r}})}},Module.locateFile=e=>_config.baseUrl+e,Module.downloadFileContent=downloadFileContent,Module.print=e=>{null==chan||chan.write({type:"stdout",data:e})},Module.printErr=e=>{null==chan||chan.write({type:"stderr",data:e})},Module.setPrompt=e=>{null==chan||chan.write({type:"prompt",data:e})},globalThis.Module=Module,setTimeout(()=>{const e=`${_config.baseUrl}R.bin.js`;loadScript(e)})}IN_NODE?(require("worker_threads").parentPort.on("message",onWorkerMessage),globalThis.XMLHttpRequest=require_XMLHttpRequest().XMLHttpRequest):globalThis.onmessage=e=>onWorkerMessage(e.data);